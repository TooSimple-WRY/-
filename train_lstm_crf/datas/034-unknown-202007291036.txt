NetTraveler Spear-Phishing Email Targets Diplomat of Uzbekistan .		malware email_evil email_evil others target_crowd others location others
Realse_Time : 20200729 Report_URL : https://unit42.paloaltonetworks.com/nettraveler-spear-phishing-email-targets-diplomat-of-uzbekistan/ Unit 42 recently identified a targeted attack against an individual working for the Foreign Ministry of Uzbekistan in China .		others others others others others others others others others others others others others others others others others target_crowd others others others government government others location others location others
A spear-phishing email was sent to a diplomat of the Embassy of Uzbekistan who is likely based in Beijing , China .		others email_evil email_evil others others others others target_crowd others others government others location others others others others others location others location others
In this report , we ’ll review how the actors attempted to exploit CVE-2012-0158 to install the NetTraveler Trojan .		others others others others others others others others others others person others others others vulnerability_cve others others others malware malware others
On December 12 , 2015 , a spear-phishing email was sent to a diplomat of the Embassy of Uzbekistan .		others time time time time others others email_evil email_evil others others others others target_crowd others others government others location others
The body and subject of the email suggests that the email was spoofed to look like it was sent by the Russian Foreign Ministry and the attachment may contain an official annual report on CHS ( Council of Heads of Member States ) , who form the SCO ( Shanghai Cooperation Organization ) .		others others others others others others others others others others reference_word others others others others others others others others others others location government government others others others others others others others others others others government others others others others others others others others others others others others government others others others others others others
Filename : “ 2015.12.11_сроки СГГ 2015 в Уфе.doc.doc ” ( translated to : “ 2015.12.11_sroki CHS in 2015 Ufe.doc.doc ” ) Body : “ С уважением , ДАТС МИД России ” ( translated to : “ Yours faithfully , ACSD Russian Foreign Ministry ” ) It is interesting to note the reference of Ufa in the file name , as the city of Ufa in Russia hosted the SCO BRICS Summit on July 9 and 10 , 2015 .		others others others sample_name sample_name sample_name sample_name sample_name others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others location others others others others others others others others others location others location others others government government others others time time time time time time others
SCO and BRICS ( Brazil , Russia , India , China and South Africa ) are intergovernmental international organizations focused on issues of regional security and economic cooperation .		government others government others others others others others others others others others others others others others others others others others others others others others others others others others others
Our analysis shows that actors attempted to exploit CVE-2012-0158 to install NetTraveler Trojan .		others others others others person others others others vulnerability_cve others others malware malware others
The malicious attachment “ 2015.12.11_сроки СГГ 2015 в Уфе.doc.doc ” is a malicious document created by the MNKit toolkit and exploits CVE-2012-0158 .		others others others others sample_name sample_name sample_name sample_name sample_name others others others others others others others others tool tool others others vulnerability_cve others
Upon successful exploitation , the attachment will install the trojan known as NetTraveler using a DLL side-loading attack technique .		others others others others others others others others others malware others others malware others others others others others others others
The NetTraveler trojan has been known to be used in targeted cyber espionage attacks for more than a decade by nation state threat actors and continues to be used to target its victims and exfiltrate data .		others malware malware others others others others others others others others others others others others others others others others others others others others person others others others others others others others others target_crowd others others others others
The DLL side-loading attack technique has been gaining adoption within the cyber espionage realm by threat actors to bypass traditional security systems .		others others others others others others others others others others others others others others others others person others others others others others others
Unit 42 also published a blog last year discussing an unrelated attack where the DLL side-loading technique was used .		security_team security_team others others others others others others others others others others others others others others others others others others
The document “ 2015.12.11_сроки СГГ 2015 в Уфе.doc.doc ” exploits CVE-2012-0158 to drop a decoy file “ ~$.doc ” and the actual payload “ DW20.exe ” .		others others others sample_name sample_name sample_name sample_name sample_name others others vulnerability_cve others others others others others others sample_name sample_name sample_name others others others others others others sample_name others others
The decoy is a blank document with the meta data stripped .		others others others others others others others others others others others others
The payload ( DW20.exe ) is a self-extracting ( SFX ) RAR archive that contains the following files :  RasTls.exe .		others others others sample_name others others others tool tool tool tool tool others others others others others others others sample_name others
rastls.dll .		sample_name others
Sycmentec.config .		sample_name others
The SFX RAR uses the following configuration to launch the embedded executable , which is a legitimate application created by Symantec that will side load the rastls.dll DLL :  Setup=RasTls.exe .		others tool tool others others others others others others others others others others others others others others others others others company others others others others others sample_name others others sample_name others
TempMode .		sample_name others
Silent=1 .		sample_name others
Overwrite=1 .		sample_name others
The ‘ Sycmentec.config ’ file can be decrypted using a single byte XOR algorithm using ‘ 0x77 ’ as a key The ‘ rastls.dll ’ DLL will load and decrypt this file .		others others sample_name others others others others others others others others others function others others others others others others others others others others sample_name others others others others others others others others others
The decrypted data starts with shellcode that is responsible for loading an embedded DLL and executing it .		others others others others others others others others others others others others others others others others others others
The embedded DLL is the functional payload , which is a variant of the NetTraveler Trojan that has the following attributes :  Size 52736 bytes .		others others others others others others others others others others others others others others malware malware others others others others others others others others others others
Type PE32 executable ( DLL ) ( GUI ) Intel 80386 , for MS Windows .		others others others others others others others others others others others others others company OS_name others
Architecture 32 Bits binary .		others others others others others
MD5	3e3df4fe831d87d7f52f14933e464fc3 .		others others others
SHA1 cce65a0b67674a313091a947506ceb91d30605ad .		others sha1 others
SHA256 3b4e4d7a0b1185a45968d90ffe6346f4621116d14dbf88b5138040acc022c757 .		others sha2 others
ssdeep 1536:jxKW1S8mWKFU7U9lYjhjXwVqTvS/G405:wCBmUw9lAhLWqW/G40 .		tool others encryption_algo encryption_algo encryption_algo encryption_algo others
imphash	85ce31f87f06b02fec915d33d82958e8 .		others others others
Date 0x564B2B07 [Tue Nov 17 13:26:31 2015 UTC] .		others others others others others others others others others others others
CRC : (Claimed ) 0x0 , ( Actual ) : 0x19be0 [SUSPICIOUS] .		others others others others others others others others others others others others others others others others
Packers	Armadillo v1.xx – v2.xx .		others others others others others others
Entry Point	0x1000970b .text 1/5 .		others others others others others others
Table 1 Attributes of the embedded DLL ( NetTraveler ) .		others others others others others others others others others others others
The first execution of this NetTraveler Trojan starts off with an installation process .		others others others others others malware malware others others others others others others others
Like previous versions , this NetTraveler sample writes its configuration to a file , in this case the configuration is written to a file named “ config.dat ” .		others others others others others malware others others others others others others others others others others others others others others others others others others others others sample_name others others
During execution , NetTraveler creates a mutex of ‘ YOYWOW!657 ’ .		others others others malware others others others others others others others others others others
The code then enumerates the ‘ netsvcs ’ services , which are services that run within the process space of svchost.exe , specifically ignoring services named ‘ 6to4 ’ and ‘ Ias ’ as these services have been used by other malware families .		others others others others others others others others others others others others others others others others others others others others sample_name others others others others others others others others others others others others others others others others others others others others others others others
When it finds another netsvcs service with a name not matching these two names .		others others others others others others others others others others others others others others others
The malware will then change the binary path of the service to point to this new filename and copies the “ Sycmentec.config ” file to the same folder and the ‘ config.dat ’ file to the following location :  c:\windows\system\CERTAPL.DLL The NetTraveler payload relies on the ‘ rastls.dll ’ file to obtain its C2 server .		others others others others others others others others others others others others others others others others others others others others others sample_name others others others others others others others others others sample_name others others others others others others others sample_name sample_name sample_name others others others others others others others sample_name others others others others others others others others
At first glance , the NetTraveler payload appears as if it will use the following URL for its C2 server :  http://192.168.3.201/downloader2013/asp/downloader.asp However , the NetTraveler payload reads the last ‘ 0xb0 ’ bytes from the rastls.dll file and uses it to create the “ config.dat ” file that is later saved to “ CERTAPL.DLL ” .		others others others others others malware others others others others others others others others others url others others tool tool others sample_name sample_name sample_name others others others malware others others others others others others others others others others others others others others others others others others others sample_name others others others others others others others others sample_name others others
This technique hides the true C2 server from researchers that do not have access to both the rastls.dll and Sycmentec.config files .		others others others others others tool tool others others others others others others others others others others others others sample_name others others
The configuration file is structured as an “ .ini ” file as the Trojan uses GetPrivateProfileStringA to parse the contents .		others others others others others others others others others others others others others malware others function others others others others others
The configuration file has the following contents :  Unit 42 analyzed the sample and found the following configuration fields that could appear in the CERTAPL.DLL configuration file and a brief description of each field :  The “ U00P ” and “ K00P ” values are decrypted using a simple algorithm that subtracts the index and then subtracts ten from each character , which is depicted in the following :  These two fields decrypt to the following , the U00P value being the C2 URL and the K00P value being the basis for an encryption key for the DES algorithm :  U00P : http://www.voennovosti.com/optdet/index.asp ( decrypted ) .		others others others others others others others others security_team security_team others others others others others others others others others others others others others others sample_name others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others url others others others others others others others others others others others others others encryption_algo encryption_algo others others others others others others others others others others
K00P : NAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM ( decrypted ) .		others others others others others others others
The C2 server will respond to requests issued by the Trojan with commands to carry out activities on the compromised system .		others tool tool others others others others others others others malware others others others others others others others others others others others
We analyzed the code within NetTraveler that handles commands issued by the C2 server and found four available commands that are listed in Table 2 .		others others others others others malware others others others others others others tool tool others others others others others others others others others others others others
Command	Description .		others others others
<Unique System ID> : UNINSTALL Deletes %APPDATA%\cert2013.dat and %STARTUP%\consent.lnk and exits the process .		others others others others others others others others url url url url url url url url url others others others others others
This attempts to uninstall the Trojan , but will not work as the filenames are not used by this version of NetTraveler .		others others others others others others others others others others others others others others others others others others others others others malware others
<Unique System ID> : RUN_REBOOT Reboots the system .		others others others others others others others others others others others
<Unique System ID> : RUN_STARTUP Downloads a file to %TEMP%\Temp.bmp and copies it to the startup folder .		others others others others others others others others others others others sample_name sample_name sample_name sample_name others others others others others others others others
<Unique System ID> : RUN_DIRECT Download a file to %TEMP%\tmp.bmp and execute it .		others others others others others others others others others others others sample_name sample_name sample_name sample_name others others others others
Table 2 Commands available within NetTraveler and a description of their functionality .		others others others others others malware others others others others others others others
At the time of analysis , the domain voennovosti.com was resolving to IP ‘ 98.126.38.107 ’ , which is hosted by Krypt Technologies .		others others others others others others others others domain others others others others others IP others others others others others others others others others
A report published by Kaspersky Labs in 2011 on NetTraveler also mentions the C2 servers were being hosted by Krypt Technolgies .		others others others others security_team security_team others time others malware others others others tool tool others others others others others others others
This web hosting service provider continues to be the hosting provider of choice for the threat actors behind NetTraveler .		others others others others others others others others others others others others others others others others person others malware others
NetTraveler has been used to target diplomats , embassies and government institutions for over a decade , and remains the tool of choice by the adversaries behind these cyber espionage campaigns .		malware others others others others others target_crowd others government others government government others others others others others others others others others others others others others others others others others others others others
The use of NetTraveler for such a long period of time shows its effectiveness and success by the adversaries in targeting their victims with impunity .		others others others malware others others others others others others others others others others others others others others others others others others target_crowd others others others
As seen in this case , the threat actors continue to evolve and employ new techniques within their modus operandi , like ‘ DLL side-loading ’ to install malware .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
It is likely that the use of ‘ DLL side loading ’ attack technique will increase due to it ’s effectiveness to bypass traditional security systems .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
It is essential to raise awareness on such attacks to better protect organizations from adversaries who maybe backed by nation states .		others others others others others others others others others others others others others others others others others others others others others others
WildFire correctly classifies NetTraveler as malicious .		tool others others malware others others others
AutoFocus tags are created to identify NetTraveler samples and respective IOCs are added to Palo Alto Networks Threat Prevention .		others others others others others others malware others others others others others others others others others others others others others