An (un)documented Word feature abused by attackers Release_Time : September 18, 2017.		others others others others others others others others others others others others others others others others others
9:00 am Report_URL :https://securelist.com/an-undocumented-word-feature-abused-by-attackers/81899/ A little while back we were investigating the malicious activities of the Freakyshelly targeted attack and came across spear phishing emails that had some interesting documents attached to them.		others others others others others others others others others others others others others others others others others others others others others others others others others attack_activity attack_activity others others others others others others others others others others
They were in OLE2 format and contained no macros, exploits or any other active content.		reference_word others others others others others others others others others others others others others others others others
However, a close inspection revealed that they contained several links to PHP scripts located on third-party web resources.		others others others others others others others others others others others others program_language others others others others others others others
When we attempted to open these files in Microsoft Word, we found that the application addressed one of the links.		others others others others others others others others company tool others others others others others others others others others others others others
The document contains no active content, no VBA macros, embedded Flash objects or PE files.		others others others others others others others others tool tool others others tool tool others tool tool others
However, when the user opens the document, Word sends the following GET request to one of the internal links.		others others others others others others others others others tool others others others attack_activity attack_activity others others others others others others others
So we opened the original document used in the attack, replaced the suspicious links with http://evil-*.		others others others others others others others others others others others others others others others others url url url url others
This code effectively sent information about the software installed on the victim machine to the attackers, including info about which version of Microsoft Office was installed.		attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity others others others others others others others company tool others others others
We decided to examine why Office followed that link, and how these links can be identified in documents.		others others others others others tool others others others others others others others others others others others others others others
The text in Word documents resides in the WordDocument stream in a ‘raw state’, i.e.		others others others tool others others others others tool others others others others others others others others others others
it contains no formatting except so-called fields.		others others others others others others others others
The fields tell Word that a certain segment of the text must be presented in a specific way; for example, it is thanks to these fields that we can see active links to other pages of the document, URL links, etc.		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
The field INCLUDEPICTURE indicates that an image is attached to certain characters in the text.		others others string others others others others others others others others others others others others others
The 0x13 byte (marked in red) in front of this field indicates that the ‘raw’ text ends there and a field description begins.		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
The link to the image in the INCLUDEPICTURE field should be in ASCII format, but in this case it is in Unicode, so Word ignores the link.		others others others others others others others string others others others others others others others others others others others others others others others others others others others others others others
The properties of characters are stored in a two-level table within document streams under the names ‘xTable’ and ‘Data’.		others others others others others others others others others others others others others others others others tool tool tool others tool tool tool others
In the actual document, these bytes are located at offsets 0xB29 – 0xB2C, but the WordDocument stream begins with offset 0x200, and the character offsets are specified relative to its beginning.		others others others others others others others others others others others others others others others others others tool others others others others others others others others others others others others others others others others others
Forms are described in a different Microsoft document: [MS-ODRAW]: Office Drawing Binary File Format.		others others others others others others tool tool others others others others others others others others others others others
The value 0x0000000E resolves into a combination of three flags: msoblipflagURL 0x00000002.		others others others others others others others others others others others others others others
msoblipflagDoNotSave 0x00000004.		others others others
msoblipflagLinkToFile 0x00000008.		others others others
This indicates that additional data should be attached to the form (it is highlighted in yellow in the screenshot), and that this data constitutes a URL that leads to the actual content of the form.		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Also, there is a ‘do not save’ flag, which prevents this content from being saved to the actual document when it is opened.		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
We should note that besides Word for Windows, this ‘feature’ is also present in Microsoft Office for iOS and in Microsoft Office for Android; LibreOffice and OpenOffice do not have it.		others others others others others tool others OS_name others others others others others others others others others tool tool others others others others tool tool others others others tool others tool others others others others others
If this document is opened in LibreOffice or OpenOffice, the malicious link is not called.		others others others others others others tool others tool others others others others others others others others
This is a complex mechanism that the bad guys have created to carry out profiling of potential victims for targeted attacks.		others others others others others others others others others others others others attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity attack_activity others
Kaspersky Lab’s security products are able to detect when the technique described in this article is used in Microsoft Word documents, and to find links embedded in a document using the same technique.		security_team security_team security_team security_team others others others others others counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure others others others others others others others others others others others others others others others others others others others others