Unraveling the Lamberts Toolkit .		others others threatActor_name others others
Release_Time : 2017-04-11 .		others others others others
Report_URL : https://securelist.com/unraveling-the-lamberts-toolkit/77990/ .		others others others others others others
Yesterday , our colleagues from Symantec published their analysis of Longhorn , an advanced threat actor that can be easily compared with Regin , ProjectSauron , Equation or Duqu2 in terms of its complexity .		others others others others others company others others others others OS_name others others others others others others others others others others others threatActor_name others threatActor_name others threatActor_name others threatActor_name others others others others others others
Longhorn , which we internally refer to as " The Lamberts " , first came to the attention of the ITSec community in 2014 , when our colleagues from FireEye discovered an attack using a zero day vulnerability ( CVE-2014-4148 ) .		company others others others others others others others others others threatActor_name others others others others others others others others others others others others time others others others person others security_team others others others others others vulnerability_cve vulnerability_cve others others vulnerability_cve others others
The attack leveraged malware we called " BlackLambert " , which was used to target a high profile organization in Europe .		others others others others others others others malware others others others others others others others target_crowd target_crowd target_crowd target_crowd others location others
Although the operational security displayed by actors using the Lamberts toolkit is very good , one sample includes a PDB path that points to a project named "Archan~1" ( perhaps "Archangel" ) .		others others others others others others others others others threatActor_name others others others others others others others others others others others others others others others others others others others others others others others others others others others
The root folder on the PDB path is named " Hudson " .		others others others others others others others others others others others others others
This is one of the very few mistakes we 've seen with this threat actor .		others others others others others others others others others others others others others others others others
The first time the Lambert family malware was uncovered publicly was in October 2014 , when FireEye posted a blog about a zero day exploit ( CVE-2014-4148 ) used in the wild .		others others others others malware malware malware others others others others others time time others others company others others others others others others others others vulnerability_cve vulnerability_cve vulnerability_cve others others others others others
The vulnerability was patched by Microsoft at the same time .		others others others others others company others others others others others
We named the malware involved " Black Lambert " and described it thoroughly in a private report , available to Kaspersky APT Intel Reports subscribers .		others others others others others others malware malware others others others others others others others others others others others others person person person person person others
The authors of Black Lambert included a couple of very interesting details in the sample , which read as the following : toolType=wl , build=132914 , versionName = 2.0.0 .		others others others malware malware others others others others others others others others others others others others others others others others others others others others others others others others others
Looking for similar samples , we were able to identify another generation of related tools which we called White Lambert .		others others others others others others others others others others others others others others others others reference_word others malware malware others
While Black Lambert connects directly to its C&C for instructions , White Lambert is a fully passive , network-driven backdoor .		malware malware malware others others others others protocol protocol protocol others others others malware malware others others others others others others others others
White Lambert runs in kernel mode and intercepts network traffic on infected machines .		malware malware others others others others others others others others others others others others
It decrypts packets crafted in a special format to extract instructions .		others others others others others others others others others others others others
We named these passive backdoors " White Lambert " to contrast with the active " Black Lambert " implants .		others others others others others others malware malware others others others others others others others malware malware others others others
Looking further for any other malware related to White Lambert and Black Lambert , we came by another generation of malware that we called Blue Lambert .		others others others others others others others others malware malware others malware malware others others others others others others others others others others others malware malware others
One of the Blue Lambert samples is interesting because it appears to have been used as second stage malware in a high profile attack , which involved the Black Lambert malware .		others others others malware malware others others others others others others others others others others others others others others others target_crowd target_crowd target_crowd others others others others others malware malware others others
Looking further for malware similar to Blue Lambert , we came by another family of malware we called Green Lambert .		others others others others others others malware malware others others others others others others others others reference_word others malware malware others
Green Lambert is a lighter , more reliable , but older version of Blue Lambert .		malware malware others others others others others others others others others others others malware malware others
Interestingly , while most Blue Lambert variants have version numbers in the range of 2.x , Green Lambert is mostly in 3.x versions .		others others others others malware malware others others others others others others others others others others malware malware others others others others others others
This stands in opposition to the data gathered from export timestamps and C&C domain activity that points to Green Lambert being considerably older than the Blue variant .		others others others others others others others others others others others others protocol protocol protocol others others others others others malware malware others others others others others malware malware others
Perhaps both Blue and Green Lamberts have been developed in parallel by two different teams working under the same umbrella , as normal software version iterations , with one seeing earlier deployment than the other .		others others malware malware malware malware others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Signatures created for Green Lambert ( Windows ) have also triggered on an OS X variant of Green Lambert , with a very low version number : 1.2.0 .		others others others malware malware others others others others others others others others OS_name OS_name others others malware malware others others others others others others others others others others
This was uploaded to a multiscanner service in September 2014 .		reference_word others others others others others others others time time others
The OS X variant of Green Lambert is in many regards functionally identical to the Windows version , however it misses certain functionality such as running plugins directly in memory .		others OS_name OS_name others others malware malware others others others others others others others others OS_name others others others others others others others others others others others others others others others
Kaspersky Lab detections for Blue , Black , and Green Lamberts have been triggered by a relatively small set of victims from around the world .		others others others others malware malware malware malware malware malware malware others others others others others others others others others others others others others others others
While investigating one of these infections involving White Lambert ( network-driven implant ) and Blue Lambert ( active implant ) , we found yet another family of tools that appear to be related .		others others others others others others others malware malware others others others others others malware malware others others others others others others others others others others others others others others others others others others
We called this new family Pink Lambert .		others others others others others malware malware others
The Pink Lambert toolset includes a beaconing implant , a USB-harvesting module and a multi-platform orchestrator framework which can be used to create OS-independent malware .		others malware malware others others others others others others others others others others others others others others others others others others others others others others others
Versions of this particular orchestrator were found on other victims , together with White Lambert samples , indicating a close relationship between the White and Pink Lambert malware families .		others others others others others others others others others target_crowd others others others malware malware others others others others others others others others malware malware malware malware malware others others
By looking further for other undetected malware on victims of White Lambert , we found yet another apparently related family .		others others others others others others others others others others malware malware others others others others others others others others others
The new family , which we called Gray Lambert is the latest iteration of the passive network tools from the Lamberts" arsenal .		others others others others others others others malware malware others others others others others others others others others others others threatActor_name others others others
The coding style of Gray Lambert is similar to the Pink Lambert USB-harvesting module , however , the functionality mirrors that of White Lambert .		others others others others malware malware others others others others malware malware others others others others others others others others others others malware malware others
Compared to White Lambert , Gray Lambert runs in user mode , without the need for exploiting a vulnerable signed driver to load arbitrary code on 64-bit Windows variants .		others others malware malware others malware malware others others others others others others others others others others others others others others others others others others others OS_name OS_name others others
Below , we provide a small summary of all the Lamberts .		others others others others others others others others others others others others
A full description of all variants is available to subscribers of Kaspersky APT Reports .		others others others others others others others others others others others security_team others others others
The only known sample of Black Lambert was dropped by a TTF-exploit zero day ( CVE-2014-4148 ) .		others others others others others malware malware others others others others vulnerability_cve vulnerability_cve vulnerability_cve others vulnerability_cve others others
Its internal configuration included a proxy server which suggests the malware was created to work in a very specific network configuration , inside the victim 's network .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
An internal description of Black Lambert indicates what appears to be a set of markers used by the attackers to denote this particular branch : toolType=wl , build=132914 , versionName = 2.0.0 .		others others others others malware malware others others others others others others others others others others others others others others others others others others others others others others others others others others others
The Blue Lambert implants contain what appear to be version numbers in the 2.x range , together with project/operation codename sets , which may also indicate codenames for the victims or campaigns .		others malware malware others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Green Lambert is a family of tools deeply related to Blue Lambert .		malware malware others others others others others others others others malware malware others
The functionality is very similar , both Blue and Green are active implants .		others others others others others others others others others others others others others others
The configuration data shares the same style of codenames for victims , operations , or projects .		others others others others others others others others others others others others others others others others others
The Green Lambert family is the only one where non-Windows variants have been found .		others malware malware others others others others others others others others others others others others
An old version of Green Lambert , compiled for OS X was uploaded from Russia to a multiscanner service in 2014 .		others others others others malware malware others others others OS_name OS_name others others others location others others others others others time others
Its internal codename is HO BO ( 1.2.0 ) .		others others others others others others others others others others
The Windows versions of Green Lambert have the following code names : BEARD BLUE ( 2.7.1 ) , GORDON FLASH ( 3.0 ) , APE ESCAPE ( 3.0.2 ) , SPOCK LOGICAL ( 3.0.2 ) , PIZZA ASSAULT ( 3.0.5 ) , and SNOW BLOWER ( 3.0.5 ) .		others OS_name others others malware malware others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Interestingly , one of the droppers of Green Lambert abused an ICSsoftware package named "Subway Environmental Simulation Program" or "SES" , which has been available on certain forums visited by engineers working with industrial software .		others others others others others person others malware malware others others tool tool others others others others others others others others others others others others others others others others others others others others others others others others others others others
Similar techniques have been observed in the past from other threat groups , for instance , trojanized Oracle installers by the Equation group .		others others others others others others others others others others others others others others others others others tool tool others threatActor_name threatActor_name threatActor_name others
White Lambert is a family of tools that share the same internal description as Black Lambert .		others others others others others others others others others others others others others others malware malware others
Known tool types , builds , and version names include :  ToolType " aa " , protocol 3 , version 7 , versionName 5.0.2 , build 113140 ToolType " aa " , protocol 3 , version 7 , versionName 5.0.0 , build 113140 ToolType " aa " , protocol 3 , version 6 , versionName 4.2.0 , build 110836M ToolType " aa " , protocol 3 , version 5 , versionName 3.2.0 .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
One of the White Lambert samples is interesting because it has a forgotten PDB path inside , which points to " Archan~1l " and " Hudson " .		others others others malware malware others others others others others others others others others others others others others others others others others others others others others others others
Hudson could point to a project name , if the authors name their projects by rivers in the US , or , it could also be the developer 's first name .		company others others others others others others others others others others others others others others others others others location others others others others others others others others others others others others others
The truncated ( 8.3 ) path " archan~1 " most likely means " Archangel " .		others others others others others others others others others others others others others others others others
The tool type " aa " could also suggest " ArchAngel " .		others others others others others others others others others others others others others
By comparison , the Black Lambert tool type " wl " has no known meaning .		others others others others others malware malware others others others others others others others others others
White Lambert samples run in kernel mode and sniff network traffic looking for special packets containing instructions to execute .		malware malware others others others others others others others others others others others others others others others others others others
To run unsigned code in kernel mode on 64-bit Windows , White Lambert uses an exploit against a signed , legitimate SiSoftware Sandra driver .		others others others others others others others others OS_name OS_name others others others others others others others others others others others tool tool others others
The same method was used before by Turla , ProjectSauron , and Equation 's Grayfish , with other known , legitimate drivers .		others others others others others others others tool tool tool tool tool tool tool tool others others others others others others others others
Pink Lambert is a suite of tools initially discovered on a White Lambert victim .		malware malware others others others others others others others others others malware malware target_crowd others
It includes a beaconing implant , partially based on publicly available source code .		others others others others others others others others others others others others others others
The source code on top of which Pink Lambert 's beaconing implant was created is " A Fully Featured Windows HTTP Wrapper in C++ " .		others others others others others others others malware malware others others others others others others others others others others OS_name others others others program_language others others
Other tools in the Pink Lambert suite include USB stealer modules and a very complex multi-platform orchestrator .		others others others others malware malware others others others others others others others others others others others others
In a second incident , a Pink Lambert orchestrator was found on another White Lambert victim , substantiating the connection between the Pink and White Lamberts .		others others others others others others malware malware others others others others others malware malware target_crowd others others others others others others others others others others others
Gray Lambert is the most recent tool in the Lamberts ' arsenal .		malware malware others others others others others others others reference_word reference_word reference_word others
It is a network-driven backdoor , similar in functionality to White Lambert .		others others others others others others others others others others malware malware others
Unlike White Lambert , which runs in kernel mode , Gray Lambert is a user-mode implant .		others malware malware others others others others others others others malware malware others others others others others
The compilation and coding style of Gray Lambert is similar to the Pink Lambert USB stealers .		others others others others others others malware malware others others others others malware malware others others others
Gray Lambert initially appeared on the computers of victims infected by White Lambert , which could suggest the authors were upgrading White Lambert infections to Gray .		malware malware others others others others others others others others others malware malware others others others others others others others others malware malware others others others others
This migration activity was last observed in October 2016 .		attack_activity attack_activity attack_activity others others others others time time others
Some of the known filenames for Gray Lambert are mwapi32.dll and poolstr.dll 'C it should be pointed though that the filenames used by the Lamberts are generally unique and have never been used twice .		others others others others others others malware malware others sample_name others sample_name sample_name sample_name others others others others others others others others others others others threatActor_name others others others others others others others others others others
Most of the Blue and Green Lambert samples have two C&C servers hardcoded in their configuration block : a hostname and an IP address .		others others others malware malware malware malware others others others protocol protocol protocol others others others others others others others others others others others protocol others others
Using our own pDNS as well as DomainTools IP history , we plotted the times when the C&C servers were active and pointing to the same IP address as the one from the configuration block .		others others others others others others others others protocol others others others others others others others others protocol protocol protocol others others others others others others others others protocol others others others others others others others others others
Another worthwhile analysis method focuses on the set of Blue Lambert samples that have exports .		others others others others others others others others others malware malware others others others others others
Although most compilation timestamps in the PE header appear to have been tampered ( to reflect a 2003-2004 range ) , the authors forgot to alter the timestamps in the export section .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
This allowed us to identify not just the activity / compilation timestamps , but also the method used for faking the compilation timestamps in the PE header .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
It seems the algorithm used to tamper with the samples was the following : subtract 0x10 from the highest byte of timestamp ( which amounts to about 8 and half years ) and then randomize the lowest 3 bytes .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
This way we conclude that for Blue Lamberts , that original compilation time of samples was in the range of 2012-2015 .		others others others others others others malware malware others others others others others others others others others others others others time others
As it can be seen from the chart above , Green Lambert is the oldest and longest-running in the family , while Gray is the newest .		others others others others others others others others others others malware malware others others others others others others others others others others others others others others others
White , Blue and Pink somehow overlap in deployment , with Blue replacing Green Lambert .		others others others others others others others others others others others others others malware malware others
Black Lambert was seen only briefly and we assume it was " retired " from the arsenal after being discovered by FireEye in 2014 .		malware malware others others others others others others others others others others others others others others others others others others others security_team time time others
The threat group (s ) behind the Lambert toolkits have used a large number of codenames extensively throughout their projects .		others others others others others others others others others others others others others others others others others others others others others others
Some of these codenames are references to old computer games , Star Trek , and cartoons , which is very unusual for high profile APT groups .		others others others others others others others others others others others others others others others others others others others others others others others others others others others
We really enjoyed going through the backstories of these codenames and wanted to provide them below for others to enjoy as well .		others others others others others others others others others others others others others others others others others others others others others others others
For instance , one of the Green Lambert versions has the internal codename " GORDON FLASH " , which can also be read as " FLASH GORDON " .		others others others others others others malware malware others others others others others others others others others others others others others others others others others others others others others
Flash Gordon is the hero of a space opera adventure comic strip created by and originally drawn by Alex Raymond .		others others others others others others others others others others others others others others others others others others others others others
It was first published in 1934 and subsequently turned into a popular film in 1980 .		others others others others time time others others others others others others others time time others
The Lamberts toolkit spans across several years , with most activity occurring in 2013 and 2014 .		others reference_word reference_word others others others others others others others others others time time time time others
Overall , the toolkit includes highly sophisticated malware , which relies on high-level techniques to sniff network traffic , run plugins in memory without touching the disk , and leverages exploits against signed drivers to run unsigned code on 64-bit Windows .		others others reference_word reference_word others others others others others others others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others others others others OS_name OS_name others
To further exemplify the proficiency of the attackers leveraging the Lamberts toolkit , deployment of Black Lambert included a rather sophisticated TTF zero day exploit , CVE-2014-4148 .		others others others others others others others others others others others others others others others malware malware others others others others vulnerability_cve vulnerability_cve vulnerability_cve others others vulnerability_cve others
Taking that into account , we classify the Lamberts as the same level of complexity as Regin , ProjectSauron , Equation and Duqu2 , which makes them one of the most sophisticated cyber espionage toolkits we have ever analysed .		others others others others others others others others others others others others others others others others threatActor_name others threatActor_name others threatActor_name others threatActor_name others others others others others others others others others others others others others others others others others
As usual , defense against attacks such as those from the Lamberts/Longhorn should include a multi-layered approach .		others others others others others others others others others others others others others others others others others others
Kaspersky products include special mitigation strategies against the malware used by this group , as well as the many other APT groups we track .		security_team others others others others others others others others others others others others others others others others others others others others others others others others
We will continue tracking the Lamberts and sharing new findings with our intel report subscribers , as well as with the general public .		others others others others others threatActor_name others others others others others others others others others others others others others others others others others others
If you would like to be the first to hear our news , we suggest you subscribe to our intel reports .		others others others others others others others others others others others others others others others others others others others others others others
Kaspersky Lab products successfully detect and eradicate all the known malware from the Lamberts family .		security_team others others others others others others others others others others others others malware others others
For more information about the Lamberts , please contact : intelreports@kaspersky.com		others others others others others threatActor_name others others others others others others others