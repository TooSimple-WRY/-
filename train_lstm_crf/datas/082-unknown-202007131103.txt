ChChes – Malware that Communicates with C&C Servers Using Cookie Headers .		malware others others others sample_function sample_function sample_function sample_function sample_function sample_function others tool tool others
Release_Time : 2017-02-15 Report_URL : https://blogs.jpcert.or.jp/en/2017/02/chches-malware--93d6.html Since around October 2016 , JPCERT/CC has been confirming emails that are sent to Japanese organisations with a ZIP file attachment containing executable files .		others others others others others others others others others others others others time time others security_team others others others others others others others others target_crowd target_crowd others others tool tool tool others tool tool others
The targeted emails , which impersonate existing persons , are sent from free email address services available in Japan .		others others others others others others others others others others others others others others others others others others location others
Also , the executable files ’ icons are disguised as Word documents .		others others others tool tool others others others others others tool others others
When the recipient executes the file , the machine is infected with malware called ChChes .		others others others others reference_word reference_word others others target_crowd others others others others others malware others
This blog article will introduce characteristics of ChChes , including its communication .		others others others others others others others malware others others others others others
While some ZIP files attached to the targeted emails in this campaign contain executable files only , in some cases they also contain dummy Word documents .		others others tool tool others others others others others others others others others tool tool others others others others others reference_word others others tool tool tool others
Below is the example of the latter case .		others others others others others others others others others
In the above example , two files with similar names are listed : a dummy Word document and an executable file whose icon is disguised as a Word document .		others others others others others others others others others others others others others others tool tool tool others others tool tool others others others others others others tool others others
By running this executable file , the machine will be infected with ChChes .		others others reference_word reference_word reference_word others others target_crowd others others others others malware others
JPCERT/CC has confirmed the executable files that have signatures of a specific code signing certificate .		security_team others others others tool tool others others others others others others others others others others
The dummy Word document is harmless , and its contents are existing online articles related to the file name “ Why Donald Trump won ” .		others tool tool tool others others others others others others others others others others others others others others others others sample_name sample_name sample_name sample_name others others
The details of the code signing certificate is described in Appendix A. ChChes is a type of malware that communicates with specific sites using HTTP to receive commands and modules .		others others others others others others others others others others others others malware others others others others others others sample_function sample_function sample_function sample_function others protocol others sample_function sample_function sample_function sample_function others
There are only few functions that ChChes can execute by itself .		others others others others others others malware others others others reference_word others
This means it expands its functions by receiving modules from C&C servers and loading them on the memory .		others others reference_word others others others others sample_function sample_function sample_function sample_function sample_function sample_function sample_function others sample_function sample_function sample_function sample_function sample_function others
As you can see , the path for HTTP request takes /[random string].htm , however , the value for the Cookie field is not random but encrypted strings corresponding to actual data used in the communication with C&C servers .		others others others others others others others others protocol others others string string string string string string others others others others others others others tool others others others others others others others others others others others others others others others others protocol protocol protocol others others
The value can be decrypted using the below Python script .		others others others others others others others others program_language others others
The value in the Cookie field of the HTTP request that ChChes first sends ( Request 1 ) contains encrypted data starting with ‘ A ’ .		others others others others tool others others others protocol others others malware others others others others others others others others others others others others others others others
As indicated , the data which is sent contains information including computer name .		others others others others others others others others others others others others others others
The format of the encrypted data differs depending on ChChes ’s version .		others others others others others others others others others malware others others others others
The details are specified in Appendix B .		others others others others others others others others
As a response to Request 1 , ChChes receives strings of an ID identifying the infected machine from C&C servers ( Response 1 ) .		others others others others others others others malware others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others
The ID is contained in the Set-Cookie field as shown below .		others others others others others others others others others others others others
Next , ChChes sends an HTTP request to receive modules and commands ( Request 2 ) .		others others malware sub_activity sub_activity sub_activity sub_activity others sample_function sample_function sample_function sample_function others others others others others
At this point , the following data starting with ‘ B ’ is encrypted and contained in the Cookie field .		others others others others others sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function others others others others tool others others
As a response to Request 2 , encrypted modules and commands ( Response 2 ) are sent from C&C servers .		others others others others others others others others others others others others others others others others others others protocol protocol protocol others others
The following shows an example of received modules and commands after decryption .		others others others others others others others others others others others others others
Commands are sent either together with modules as a single data ( as above ) , or by itself .		others others others others others others others others others others others others others others others others others others others others
Afterwards , execution results of the received command are sent to C&C servers , and it returns to the process to receive modules and commands .		others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others protocol protocol protocol others others others others sub_activity sub_activity sub_activity sub_activity others sample_function sample_function sample_function sample_function others
This way , by repeatedly receiving commands from C&C servers , the infected machines will be controlled remotely .		others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others target_crowd target_crowd others others others others others
JPCERT/CC ’s research has confirmed modules with the following functions , which are thought to be the bot function of ChChes :  Encrypt communication using AES , Execute shell commands , Upload files , Download files , Load and run DLLs , View tasks of bot commands .		security_team others others others others others others others others others others others others others others others others others others others others malware others sample_function sample_function sample_function sample_function others sample_function sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function sample_function sample_function others sample_function sample_function sample_function sample_function sample_function others
Especially , it was confirmed that the module that encrypts the communication with AES is received in a relatively early stage after the infection .		others others others others others others others others others sample_function sample_function sample_function sample_function sample_function others others others others others others others others others others others
With this feature , communication with C&C servers after this point will be encrypted in AES on top of the existing encryption method .		others others others others others others protocol protocol protocol others others others others others others others others encryption_algo others others others others others others others others
ChChes is a relatively new kind of malware which has been seen since around October 2016 .		malware others others others others others others others others others others others others others time time others
As this may be continually used for targeted attacks , JPCERT/CC will keep an eye on ChChes and attack activities using the malware .		others others others others others others others others others others security_team others others others others others malware others others others others reference_word reference_word others
The hash values of the samples demonstrated here are described in Appendix C. The malware ’s destination hosts that JPCERT/CC has confirmed are listed in Appendix D. We recommend that you check if your machines are communicating with such hosts .		others others others others others others others others others others others others others reference_word reference_word others others target_crowd target_crowd others security_team others others others others others others others others others others others others others others others others others others others others others
The lists below describe encrypted data contained in the first HTTP request and explanation of the values for each ChChes version .		others others others others others others others others others others protocol others others others others others others others others malware others others
ChChes : 5961861d2b9f50d05055814e6bfd1c6291b30719f8a4d02d4cf80c2e87753fa1 ChChes : ae6b45a92384f6e43672e617c53a44225e2944d66c1ffb074694526386074145 ChChes : 2c71eb5c781daa43047fa6e3d85d51a061aa1dfa41feb338e0d4139a6dfd6910 ChChes : 19aa5019f3c00211182b2a80dd9675721dac7cfb31d174436d3b8ec9f97d898b ChChes : 316e89d866d5c710530c2103f183d86c31e9a90d55e2ebc2dda94f112f3bdb6d ChChes : efa0b414a831cbf724d1c67808b7483dec22a981ae670947793d114048f88057 .		malware others others malware others sha2 malware others sha2 malware others sha2 malware others others malware others sha2 others
ChChes : area.wthelpdesk.com ChChes : dick.ccfchrist.com ChChes : kawasaki.cloud-maste.com ChChes : kawasaki.unhamj.com ChChes : sakai.unhamj.com ChChes : scorpion.poulsenv.com .		malware others domain_evil malware others domain_evil malware others domain_evil malware others domain_evil malware others domain_evil malware others domain_evil others