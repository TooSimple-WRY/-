DarkPulsar Release_Time :  2018-10-19 .		threatActor_name others others others others
Report_URL :  https://securelist.com/darkpulsar/88199/ .		others others others others others others
In March 2017 , the ShadowBrokers published a chunk of stolen data that included two frameworks : DanderSpritz and FuzzBunch .		time time time others others threatActor_name others others others others others others others others others others others tool others tool others
DanderSpritz consists entirely of plugins to gather intelligence , use exploits and examine already controlled machines .		tool others others others others others others others others others others others others others others others others
It is written in Java and provides a graphical windows interface similar to botnets administrative panels as well as a Metasploit-like console interface .		reference_word others others others program_language others others others others others others others others malware others others others others others others others others others others
It also includes its own backdoors and plugins for not-FuzzBunch-controlled victims .		reference_word others others others others malware others others others others person others
Fuzzbunch on the other hand provides a framework for different utilities to interact and work together .		tool others others others others others others others others others others others others others others others others
It contains various types of plugins designed to analyze victims , exploit vulnerabilities , schedule tasks , etc .		reference_word others others others others tool others others sub_activity sub_activity others sub_activity sub_activity others sub_activity sub_activity others others others
There are three files in the plugin set from the FuzzBunch framework : %pluginName%-version.fb .		others others others others others others others others others others tool others others sample_name sample_name sample_name sample_name others
This is the utility file of the framework .		others others others others others others others others others
It duplicates the header from XML and includes the plugin's ID .		reference_word others others others others protocol others others others others others others others
%pluginName%-version.exe .		sample_name sample_name sample_name sample_name others
This executable file is launched when FuZZbuNch receives the command to do so .		others others others others others others tool others others others others others others others
%pluginName%-version.xml .		sample_name sample_name sample_name sample_name others
This configuration file describes the plugin ’s input and output parameters – the parameter name , its type and description of what it ’s responsible for ; all of these can be shown in FuzzBunch as a prompt .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others tool others others others others
This file also contributes a lot to the framework ’s usability , as it supports the specification of default parameters .		others others others others others others others others others others others others others others reference_word others others others others others others others
One of the most interesting Fuzzbunch ’s categories is called ImplantConfig and includes plugins designed to control the infected machines via an implant at the post-exploitation stage .		others others others others others tool others others others others others tool others others others others others others others others others others others others others others others others others
DarkPulsar is a very interesting administrative module for controlling a passive backdoor named ‘ sipauth32.tsp ’ that provides remote control , belonging to this category .		others others others others others others others others others others others malware others others malware others others others others others others others others others others others
It supports the following commands :  Burn , RawShellcode , EDFStagedUpload , DisableSecurity , EnableSecurity , UpgradeImplant , PingPong .		reference_word others others others others others tool others tool others tool others tool others tool others tool others tool others
Burn , RawShellcode , UpgradeImplant , and PingPong remove the implant , run arbitrary code , upgrade the implant and check if the backdoor is installed on a remote machine , respectively .		tool others tool others tool others others tool others others others others others others others others others others others others others others others malware others others others others others others others others others
The purpose of the other commands is not that obvious and , to make it worse , the leaked framework contained only the administrative module to work with DarkPulsar ’s backdoor , but not the backdoor itself .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others threatActor_name others others malware others others others others malware reference_word others
While analyzing the administrative module , we noticed several constants that are used to encrypt the traffic between the C&C and the implant .		others others others others others others others others others others others others others others others others others others others tool tool tool others others others others
We thought that probably these constants should also appear in the backdoor , so we created a detection for them .		others others others others others others others others others others others malware others others others others others others others others others
Several months later we found our mysterious DarkPulsar backdoor .		others others others others others others others threatActor_name malware others
We later were able to find both 32- and 64-bit versions .		others others others others others others others others others others others others
We found around 50 victims located in Russia , Iran and Egypt , typically infecting Windows 2003/2008 Server .		others others others others person others others location others location others location others others others OS_name others others others
Targets were related to nuclear energy , telecommunications , IT , aerospace and R&D .		others others others others industry industry others industry others industry others industry others industry industry industry others
The DarkPulsar implant is a dynamic library whose payload is implemented in exported functions .		others others others others others others others others others others others others others others others
These functions can be grouped as follows :  Two nameless functions used to install the backdoor in the system .		others others others others others others others others others others others others others others others malware others others others others
Functions with names related to TSPI ( Telephony Service Provider Interface ) operations that ensure the backdoor is in the autorun list and launched automatically .		others others others others others function others function function function function others others others others others malware others others others others others others others others others
A function with a name related to SSPI ( Security Support Provider Interface ) operations .		others others others others others others others function others function function function function others others others
It implements the main malicious payload .		others others others others others others others
The implementations of the SSPI and TSPI interfaces are minimalistic : the functions that are exported by DarkPulsar have the same names as the interface functions ; however , they include malicious code instead of the phone service .		others others others others function others function others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
The implant is installed in the system by the nameless exported function .		others others others others others others others others others others others others others
The backdoor is launched by calling Secur32.AddSecurityPackage with administrator privileges with the path to its own library in the parameter , causing lsass.exe to load DarkPulsar as SSP/AP and to call its exported function SpLsaModeInitialize used by DarkPulsar to initialize the backdoor .		others malware others others others others function others others others others others others others others others others others others others others others sample_name others others threatActor_name others tool others others others others others others function others others threatActor_name others others others malware others
In this way AddSecurityPackage is used to inject code into lsass.exe .		others others others function others others others others others others sample_name others
It also adds its library name at HKLM\Software\Microsoft\Windows\CurrentVersion\Telephony\Providers This is loaded at start by the Telephony API ( TapiSrv ) launched alongside the Remote Access Connection Manager ( RasMan ) service , setting startup type as “ Automatic ” .		reference_word others others others others others others string others others others others others others others others tool others tool others others others others tool tool tool tool others tool others others others others others others others others others others others
When loading the telephony service provider ’s library , TapiSrv calls TSPI_lineNegotiateTSPIVersion which contains the AddSecurityPackage call to make the inject into lsass.exe .		others others others others others others others others others others tool others function others others others function others others others others others others sample_name others
DarkPulsar implements its payload by installing hooks for the SpAcceptLsaModeContext – function responsible for authentication .		threatActor_name others others others others others others others others function others others others others others others
Such injects are made in several system authentication packets within the process lsass.exe and allow Darkpulsar to control authentication process based on the following protocols : Msv1_0.dll – for the NTLM protocol , Kerberos.dll – for the Kerberos protocol , Schannel.dll – for the TLS/SSL protocols , Wdigest.dll – for the Digest protocol , and Lsasrv.dll –for the Negotiate protocol .		others others others others others others others others others others others others sample_name others others threatActor_name others others others others others others others others others others sample_name others others others protocol others others sample_name others others others protocol others others sample_name others others others protocol others others sample_name others others others protocol others others others sample_name others others protocol others others
After this , Darkpulsar gets ability to embed malware traffic into system protocols .		others others others threatActor_name others others others others others others others others others others
Since this network activity takes place according to standard system charts , it will only be reflected in the System process – it uses the system ports reserved for the above protocols without hindering their normal operation .		others others others others others others others others others others others others reference_word others others others others others others others others others reference_word others others others others others others others others others others others others others others others
Network traffic during successful connection to DarkPulsar implant .		others others others others others others threatActor_name others others
The second advantage of controlling authentication processes is ability to bypass entering a valid username and password for obtaining access to objects that require authentication such as processes list , remote registry , file system through SMB .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others protocol others
After Darkpulsar ’s DisableSecurity command is sent , backdoor ’s hooks on the victim side will always returns in the SpAcceptLsaModeContext function that passed credentials are valid .		others threatActor_name others others function others others others others malware others others others others others others others others others others others others function others others others others others others others
Getting that , system will provide access to protected objects to client .		others others others others others others others others others others others others others
Darkpulsar-1.1.0.exe is the administrative interface working under the principle of “ one command – one launch ” .		sample_name others others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity others others
The command to be executed must be specified either in the configuration file Darkpulsar-1.1.0.9.xml or as command line arguments , detailing at least : whether the target machine uses a 32-bit or 64-bit system , protocol ( SMB , NBT , SSL , RDP protocols are supported ) to deliver the command and port number , private RSA key to decrypt the session AES key .		others others others others others others others others others others others others others sample_name others others others others others others others others others others others others others others others others others others others others others others others protocol others protocol others protocol others protocol others others others others others others others others others others others others others tool tool others others others others tool tool others
Darkpulsar-1.1.0 was not designed as a standalone program for managing infected machines .		tool others others others others others others others others others others others others
This utility is a plugin of the Fuzzbunch framework that can manage parameters and coordinate different components .		reference_word reference_word others others others others others tool others others others others others others others others others others
Here is how DisableSecurity command in Fuzzbunch looks like .		others others others function others others tool others others others
Below is an example of Processlist after DisableSecurity , allowing to execute any plugin without valid credentials and operating via regular system functions ( remote registry service ) .		others others others others others others others function others others others others others others others others others others others others others others others others others others others others others
DanderSpritz is the framework for controlling infected machines , different from FuZZbuNch as the latter provides a limited toolkit for the post-exploitation stage with specific functions such as DisableSecurity and EnableSecurity for DarkPulsar .		tool others others others others others others others others others others tool others others others others others others others others others others others others others others others others function others function others threatActor_name others
For DanderSpritz works for a larger range of backdoors , using PeedleCheap in the victim to enable operators launching plugins .		others tool others others others others others others malware others others tool others others others others others others others others others
PeddleCheap is a plugin of DanderSpritz which can be used to configure implants and connect to infected machines .		tool others others others others tool others others others others others others others others others others others others others
Once a connection is established all DanderSpritz post-exploitation features become available .		others others others others others others tool others others others others others
This is how DarkPulsar in EDFStagedUpload mode provides the opportunity to infect the victim with a more functional implant : PCDllLauncher ( Fuzzbunch ’s plugin ) deploys the PeddleCheap implant on the victim side , and DanderSpritz provides a user-friendly post-exploitation interface .		others others others threatActor_name others tool others others others others others others others others others others others others others others tool others tool others others others others others others tool others others others others others others others tool others others others others others others
Hence , the full name of PCDllLauncher is ‘ PeddleCheap DLL Launcher ’ .		others others others others others others tool others others tool tool tool others others
The complete DanderSpritz usage scheme with the plugin PeddleCheap via FuZZbuNch with the plugins DarkPulsar and PCDllLauncher consists of four steps : Via FuZZbuNch , run command EDFStagedUpload to launch DarkPulsar .		others others tool others others others others others tool others tool others others others threatActor_name others tool others others others others others others tool others others others tool others others threatActor_name others
In DanderSpritz , run command pc_prep ( PeedelCheap Preparation ) to prepare the payload and the library to be launched on the implant side .		others tool others others others tool others tool tool others others others others others others others others others others others others others others others others
In DanderSpritz , run command pc_old ( which is the alias of command pc_listen -reuse -nolisten -key Default ) – this sets it to wait for a socket from Pcdlllauncher .		others tool others others others tool others others others others others others others tool tool tool tool tool others others others others others others others others others others others tool others
Launch Pcdlllauncher via FuZZbuNch and specify the path to the payload that has been prepared with the command pc_prep in the ImplantFilename parameter .		others tool others tool others others others others others others others others others others others others others others tool others others function others others
The FuzzBunch and DanderSpritz frameworks are designed to be flexible and to extend functionality and compatibility with other tools .		others tool others tool others others others others others others others others others others others others others others others others
Each of them consists of a set of plugins designed for different tasks : while FuzzBunch plugins are responsible for reconnaissance and attacking a victim , plugins in the DanderSpritz framework are developed for managing already infected victims .		others others reference_word others others others others others others others others others others others others tool others others others others sub_activity others sub_activity sub_activity sub_activity others others others others tool others others others others others others others others others
The discovery of the DarkPulsar backdoor helped in understanding its role as a bridge between the two leaked frameworks , and how they are part of the same attacking platform designed for long-term compromise , based on DarkPulsar ’s advanced abilities for persistence and stealthiness .		others others others others threatActor_name malware others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others threatActor_name others others others others others others others others others
The implementation of these capabilities , such as encapsulating its traffic into legitimate protocols and bypassing entering credentials to pass authentication , are highly professional .		others others others others others others others others others others others others others others others others others others others others others others others others others others
Our product can completely remove the related to this attack malware .		others others others others others others others others others others others others
When EDFStagedUpload is executed in an infected machine , a permanent connection is established , which is why traffic via port 445 appears .		others tool others others others others others others others others others others others others others others others others others others others others others others
A pair of bound sockets also appears in lsass.exe .		others others others others others others others others sample_name others
When DanderSpritz deploys PeddleCheap ’s payload via the PcDllLauncher plugin , network activity increases dramatically .		others tool others tool others others others others others tool others others others others others others others
When a connection to the infected machine is terminated , network activity ceases , and only traces of the two bound sockets in lsass.exe remain .		others others others others others others others others others others others others others others others others others others others others others others others sample_name others others
implant – 96f10cfa6ba24c9ecd08aa6d37993fe4 .		others others sha1 others
File path – %SystemRoot%\System32\sipauth32.tsp .		others others others string string string string others
Registry – HKLM\Software\Microsoft\Windows\CurrentVersion\Telephony\Providers .		others others string others