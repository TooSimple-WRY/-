Operation RAT Cook: Chinese APT actors use fake Game of Thrones leaks as lures .		attack_activity attack_activity attack_activity others others others person others tool tool tool tool tool others others others
Release_Time :  2017-08-25 Report_URL :  https://www.proofpoint.com/us/threat-insight/post/operation-rat-cook-chinese-apt-actors-use-fake-game-thrones-leaks-lures Proofpoint recently observed a targeted email campaign attempting a spearphishing attack using a Game of Thrones lure .		others others others others others others others others security_team others others others others others others others others attack_activity attack_activity others others tool tool tool tool others
The malicious attachment , which offered salacious spoilers and video clips , attempted to install a “ 9002 ” remote access Trojan ( RAT ) historically used by state-sponsored actors.Previous attacks involving the 9002 RAT include :  Operation Aurora , an attack on companies such as Google , widely attributed to the Chinese government .		others tool tool others others sample_function sample_function sample_function sample_function sample_function sample_function others others others others others others others others tool tool tool others tool others others others others others others attack_activity others others tool tool others others attack_activity attack_activity others others others others others others others company others others others others others others others others
Operation Ephemeral Hydra , a strategic website compromise utilizing an Internet Explorer zero-day , which FireEye attributed to an APT actor without a country attribution .		attack_activity attack_activity attack_activity others others others others others others others tool tool tool others others company others others others person person others others others others others
Attacks on Asian countries described by Palo Alto .		others others others others others others person person others
On August 10 Proofpoint detected malicious email messages purporting to contain unreleased Game of Thrones content .		others time time security_team others others others others others others others others others others others others others
The email used the subject line "Wanna see the Game of Thrones in advance?"		others others others others others others others others others others others others others others others others others others
These lures are especially relevant since Season 7 of Game of Thrones premiered in July and concludes on Sunday , August 27 , and the email claims to contain spoilers for the current season .		others others others others others others others others others others others others others others time others others others time time time time others others others others others others others others others others others others others
It is worth noting that episodes 4 and 6 were already leaked ; it is unlikely that responding to the lure would actually net a recipient new , unreleased episodes , particularly considering that the final episode airs this weekend .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
The email contains a Microsoft Word attachment named "game of thrones preview.docx ” .		others tool others others tool tool tool others others sample_name sample_name sample_name sample_name others others
Similar to the email , the document uses a lure listing potential spoilers and claims to contain a preview of the purported spoilers .		others others others others others others tool others others tool sample_function sample_function sample_function others others others others others others others others others others others
In reality , the “ preview ” is an embedded .LNK ( an OLE packager shell object ) that , if run , executes a malicious PowerShell script leading to the installation of the diskless “ 9002 ” RAT .		others others others others others others others others others tool tool others others tool tool tool tool others others others others others others sample_function sample_function sample_function sample_function sample_function others others others sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function others
When the embedded .LNK object is executed by the potential victim , it runs a PowerShell command using a modified Invoke-Shellcode PowerShell script to download two files obfuscated using XOR and base64 .		others others tool tool others others others others others others others others reference_word others others tool others others others others tool tool tool others sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function others
The first downloaded file contains the 9002 RAT shellcode that is injected into a legitimate Windows Mail binary wabmig.exe .		others others tool tool others others tool tool tool others others others others others others others others others sample_name others
The other downloaded file is a .LNK file that is used as a means to maintain persistence on the infected machine .		others others tool tool others others tool others others others others others others others others sample_function sample_function sample_function sample_function sample_function sample_function others
The HTTP requests to retrieve the encoded payloads are fairly basic and do not attempt to masquerade as a legitimate browser request .		others protocol others others sample_function sample_function sample_function sample_function others others others others others others others others others others others others others others others
Interestingly , if the same URI is requested with any type of User-Agent then a legitimate JPG is returned .		others others others others others others others others others others others others others others others others tool others others others
The persistence .LNK is stored in the Startup directory as UpdateCheck.lnk and contains a PowerShell script that is almost identical to the .LNK downloader .		others tool tool others others others others location location others sample_name others others others tool tool others others others others others others tool tool others
However , instead of downloading the shellcode , it opens , decodes , and injects the already downloaded shellcode into a newly created wabmig.exe process .		others others others others others others others others reference_word sample_function others sample_function others others sample_function sample_function sample_function sample_function sample_function others others others others sample_name others others
This variant of 9002 is capable of communicating over both HTTP and what appears to be fake SSL .		others others others tool others others others sample_function others others protocol others others others others others others protocol others
The fake SSL component contains at least two hardcoded packets : one for the Client_Hello and another for the Client_Key_Exchange .		others others protocol tool others others others others others others others others others others tool others others others others tool others
Most of the hardcoded values , such as the Session ID , stay the same .		others others others tool tool others others others others tool tool others sample_function sample_function sample_function others
However , the Random fields are dynamically generated ( GMT Unix Time and Random Bytes ) .		others others others others others others others others others others others others others others others others others
Finally , the Client_Hello attempts to mimic SSL traffic to login.live.com by sending that domain in the SNI field .		others others others tool others others sample_function protocol sample_function sample_function domain others sample_function sample_function sample_function sample_function sample_function sample_function sample_function others
The HTTP traffic and encoding that is utilized in this variant of 9002 has several distinguishing characteristics .		others protocol tool others tool others others others others others others others tool others others others others others
Data sent to the command and control ( C&C ) in the HTTP POST ’s client body is transmitted in an encoded state using a custom algorithm followed by base64-encoding .		others others others others protocol protocol protocol others protocol protocol protocol others others others protocol others others others others others others others others others others others others others others others others others others others
The encoding algorithm used in this version is an iteration of the “ 4-byte XOR version of 9002 ” analyzed by FireEye .		others others others others others others others others others others others others others encryption_algo encryption_algo encryption_algo encryption_algo encryption_algo others others others company others
Instead of the standard dynamic 4-byte XOR operation that is used in the older variant , a dynamic 4-byte XOR key is used along with a static 38-byte seed of “ \x3A\x42\x46\x41\x53\x41\x39\x41\x46\x2D\x44\x38\x37\x32\x6D\xF1\x51\x4A\xC0\x2D\x3A\x43\x31\x30\x2D\x30\x30\x43\x30\x35\x4A\x4D\x39\xF3\xD3\x38\x2B\x7D ” to generate a final 256-byte XOR key .		others others others others encryption_algo encryption_algo encryption_algo others others others others others others others others others others encryption_algo encryption_algo encryption_algo others others others others others others tool tool tool others others string others others sample_function sample_function sample_function sample_function sample_function sample_function others
To generate the final key , first the 38-byte seed is used with an iterative addition to generate a 256-byte value .		others sample_function sample_function sample_function sample_function others others others others others others others others others others others others sample_function sample_function sample_function sample_function others
Next , the first 4-bytes of the encoded data are XOR ’ed with the 256-byte value to generate the final 256-byte XOR key .		others others others others others others others sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function others sample_function sample_function sample_function sample_function sample_function sample_function others
This key is then XOR ’ed with the rest of the encoded data .		others others others others others others others others others others others others others others others
Similar to previous versions of 9002 , a value resembling a date ( “ \x17\x05\x15\x20 ” ) is hardcoded in the malware and can be found at offset 0x1C in beacons sent to its C&C .		others others others others others tool others others others others others others others others string others others others others others others others others others others others others others others others others others others others protocol protocol protocol others
The value likely represents the date May 17 , 2015 , but we are not aware if this date has any significance .		others others others others others others time time time time others others others others others others others reference_word reference_word others others others others
An additional value , 201707 , is hardcoded in this variant which likely refers to July 2017 .		others others others others others others others others others others others others others others others time time others
This is the most likely explanation , given that the earliest use of the malicious LNK PowerShell downloader ( sha256: 9e49d214e2325597b6d648780cf8980f4cc16811b21f586308e3e9866f40d1cd ) we have identified is a compressed file ( sha256: bdd695363117ba9fb23a7cbcd484d79e7a469c11ab9a6e2ad9a50c678097f100 ) uploaded to a malicious file scanning service on July 6 , 2017 .		others others others others others others others others others others others others others others others tool tool tool others encryption_algo others sha2 others others others others others others tool tool others encryption_algo others sha2 others sample_function sample_function sample_function sample_function sample_function sample_function sample_function others time time time time others
The modified timestamp for the files contained in the ZIP file is July 1 , 2017 .		others others others others reference_word reference_word others others others tool tool others time time time time others
The ZIP package contains four copies of the same LNK that was used in the Game of Thrones attack as well as a legitimate JPG of what appears to be a stock picture of a “ party.		others tool tool others tool tool tool tool tool tool others others others others others attack_activity attack_activity attack_activity attack_activity others others others others others tool others others others others others others others others others others others others others
” We have also identified a third possible campaign utilizing the same LNK in a DOCX document attachment named “ need help.docx ” .		others others others others others others others others others others others others tool others others tool tool tool others others sample_name sample_name others others
In this instance , the lure is to double-click on a LNK masquerading as a video .		others others others others others others others others others others others tool others others others others others
While searching for other potentially related campaigns we discovered a nexus of activity occurring at least as far back as April 2014 .		others others others others others others others others others attack_activity attack_activity attack_activity attack_activity others others others others others others others time time others
Several ZIP compressed files containing a similar LNK downloader were uploaded to a malicious file scanning service .		others tool tool tool others others others tool tool others sample_function sample_function sample_function sample_function sample_function sample_function sample_function others
All five of the archives contained a similar stock picture of a party as well as multiple copies of the malicious LNK with party picture-themed names .		others others others others others others others others others others others others others others others others others others others others tool tool others others others others others
The LNK PowerShell downloader uses similar paths to the recent attacks as well as the same “ /x/ ” URI .		others tool tool tool others others others others others others others others others others others others others others others others others
Instead of using code injection however , a packed executable ( PE ) is embedded in the PowerShell script , saved as x.exe , and is used to execute the downloaded payload that is saved as y.exe .		others others others others others others others others tool tool others tool others others others others others tool others others others others sample_name others others others others others sample_function sample_function sample_function sample_function others others others others sample_name others
An additional similarity is that the LNKs from the 2014 archives share the same Volume Serial Number as the LNK from the recent attacks ( 0xCC9CE694 ) .		others others others others others others others others others time others others others others tool tool tool others others others others others others others others string others others
The volume serial number is metadata found in the LNK file ; since they match , we know it is more likely that they were created on the device or using the same builder .		others tool tool tool others others others others others tool tool others others others others others others others others others others others others others others others others others others others others others others others others
It is possible to fake these values however we do not believe that likely in this case .		others others others others others others others others others others others others others others others others others others
Unfortunately we do not know what payload was hosted at mn1.org .		others others others others others others others others others others domain_evil others
However , two of the ZIP archives contained a Java payload named PhotoShow.jar that ultimately executes a diskless 9002 variant with a C&C of mx.i26.org .		others others others others others tool others others others program_language tool others sample_name others others sample_function sample_function sample_function sample_function sample_function others others protocol protocol protocol others domain_evil others
This variant has a hardcoded identifier of “ \x28\x02\x13\x20 ” .		others others others others others others others others string others others
Based on several shared identifiers , it is possible that the recent campaigns were conducted by the same actor that conducted the campaigns in early- to mid-2014 .		others others others others others others others others others others others others others others others others others others others others others others others others time time time others
The malicious LNK files in both campaigns ( 2014 vs. 2017 ) have the same Volume Serial Number of 0xCC9CE694 .		others tool tool tool others others others others time others time others others others others tool tool tool others string others
Furthermore , the LNK filename used in one of the campaigns this year is almost identical to the campaigns in 2014: Party00[1-35].jpg.lnk ( 2017 ) vs. Party-00[1-5].jpg.lnk ( 2014 ) .		others others others tool others others others others others others others others others others others others others others others others time others sample_name sample_name sample_name sample_name sample_name others time others others sample_name sample_name sample_name sample_name sample_name others time others others
Finally , the theme of party pictures and stock-JPGs used in both the 2017 and 2014 campaigns are extremely similar .		others others others others others others others others others others others others others time others time others others others others others
The 2014 campaign resembles activity previously attributed to the Deputy Dog ( aka APT17 ) actor .		others time others others others others others others others threatActor_aliases threatActor_aliases others others threatActor_name others others others
Additionally , the Deputy Dog actor has been observed utilizing a similar 9002 RAT with an earlier iteration of the 4-byte XOR encoding algorithm in diskless mode .		others others others threatActor_aliases threatActor_aliases others others others others others others others tool tool others others others others others others encryption_algo encryption_algo others others others others others others
Another possible similarity is the use of some of the code from the Java Reverse Metasploit-Stager in the exploits previously analyzed by FireEye as well as the PhotoShow.jar payload .		others others others others others others others others others others others others others program_language tool tool others others others others others others company others others others others sample_name others others
Although we do not possess any definitive evidence linking this activity to Deputy Dog , there are enough similarities to support a possible connection .		others others others others others others others others others others others others threatActor_aliases threatActor_aliases others others others others others others others others others others others
Based on similarities in code , payload , file names , images , and themes , it is possible that this attack was carried out by a Chinese state-sponsored actor known as Deputy Dog .		others others others others others others others others others others others others others others others others others others others others others others others others others others others person person person others others threatActor_aliases threatActor_aliases others
The use of a Game of Thrones lure during the penultimate season of the series follows a common threat actor technique of developing lures that are timely and relevant , and play on the human factor - the natural curiosity and desire to click that leads to so many malware infections .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
While Proofpoint systems blocked this attack , the use of such lures , combined with sophisticated delivery mechanisms and powerful tools like the latest version of the 9002 RAT can open wide doors into corporate data and systems for the actors behind these attacks .		others security_team others others others others others others others others others tool others others others others others others others others others others others others others others others tool tool others sample_function sample_function sample_function sample_function sample_function sample_function sample_function sample_function others person person others others others others