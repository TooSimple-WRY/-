Operation AppleJeus : Lazarus hits cryptocurrency exchange with fake installer and macOS malware .		others malware others threatActor_name others attack_goal attack_goal others tool tool others OS_name malware others
Release_Time :  2018-08-23 .		others others others others
Report_URL :  https://securelist.com/operation-applejeus/87553/ .		others others others others others others
Lazarus has been a major threat actor in the APT arena for several years .		threatActor_name others others others others person person others others attack_activity others others others others others
Alongside goals like cyberespionage and cybersabotage , the attacker has been targeting banks and other financial companies around the globe .		others others others attack_goal others attack_goal others others person others others others target_crowd others others target_crowd target_crowd others others others others
Over the last few months , Lazarus has successfully compromised several banks and infiltrated a number of global cryptocurrency exchanges and fintech companies .		others others others others others others threatActor_name others others others others target_crowd others others others others others others target_crowd target_crowd others target_crowd target_crowd others
Kaspersky Lab has been assisting with incident response efforts .		security_team security_team others others others others others others others others
While investigating a cryptocurrency exchange attacked by Lazarus , we made an unexpected discovery .		others others others target_crowd target_crowd others others threatActor_name others others others others others others others
The victim had been infected with the help of a trojanized cryptocurrency trading application , which had been recommended to the company over email .		others target_crowd others others others others others others others others malware malware malware malware others others others others others others others others others others others
It turned out that an unsuspecting employee of the company had willingly downloaded a third-party application from a legitimate looking website and their computer had been infected with malware known as Fallchill , an old tool that Lazarus has recently switched back to .		others others others others others others others others others others others others others others others others others others others others others others target_crowd target_crowd others others others others others others others malware others others others others others threatActor_name others others others others others others
There have been multiple reports on the reappearance of Fallchill , including one from US-CERT .		others others others others others others others others others malware others others others others security_team others
To ensure that the OS platform was not an obstacle to infecting targets , it seems the attackers went the extra mile and developed malware for other platforms , including for macOS .		others others others others others others others others others others others others others others others others others person others others others others others others others others others others others others others OS_name others
A version for Linux is apparently coming soon , according to the website .		others others others OS_name others others others others others others others others others others
It ’s probably the first time we see this APT group using malware for macOS .		others others others others others others others others others reference_word reference_word reference_word others others others OS_name others
The fact that the Lazarus group has expanded its list of targeted operating systems should be a wake-up call for users of non-Windows platforms .		others others others others threatActor_name others others others others others others others target_crowd target_crowd others others others others others others others others others others others
Thanks to Kaspersky Lab ’s malicious-behavior detection technology , implemented in its endpoint security software , we were able to reassemble the stages of infection and trace them back to their origin .		others others security_team security_team others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
This helped us understand that one of Lazarus ’  victims was infected with malware after installing a cryptocurrency trading program .		others others others others others others others threatActor_name others target_crowd others others others others others others others malware malware malware others
We also confirmed that the user installed this program via a download link delivered over email .		others others others others others person others reference_word reference_word others others others others others others others others
Including malicious code into distributed software and putting that on a website would be too obvious .		others others others others others others others others others others others others others others others others others
Instead , the attackers went for a more elaborate scheme :  the trojan code was pushed out in the form of an update for a trading application .		others others others person others others others others others others others others malware others others others others others others others others others others others others others others others
A legitimate-looking application called Celas Trade Pro from Celas Limited showed no signs of malicious behaviour and looked genuine .		others others others others malware malware malware others company company others others others others others others others others others others
This application is an all-in-one style cryptocurrency trading program developed by Celas .		reference_word reference_word others others others others malware malware malware others others company others
When we started this research , any user could download the trading application from the Celas website .		others others others others others others others person others others others malware malware others others company others others
Checking the installation package downloaded from the website confirmed the presence of a very suspicious updater .		others others others others others others others others others others others others others others others others others
We have analyzed the following Windows version of the installation package :  MD5 :  9e740241ca2acdc79f30ad2c3f50990a .		others others others others others OS_name others others others others others others others others md5 others
File name :  celastradepro_win_installer_1.00.00.msi .		others others others others others
File type :  MSI installer .		others others others others others others
Creation time :  2018-06-29 01:16:00 UTC .		others others others time time others others
At the end of the installation process , the installer immediately runs the Updater.exe module with the “ CheckUpdate ”  parameter .		others others others others others others others others others malware others others others sample_name others others others others tool others others others
This file looks like a regular tool and most likely will not arouse the suspicion of system administrators .		reference_word reference_word others others others others others others others others others others others others others others person person others
After all , it even contains a valid digital signature , which belongs to the same vendor .		others others others reference_word others others others others others others others others others others others others others others
But the devil is in the detail , as usual .		others others others others others others others others others others others
The code writer developed this project under the codename “ jeus ”  , which was discovered in a PDB path included in the updater and used as unique HTTP multipart message data separator string .		others others person others others others others others others others tool others others others others others others others others others others others others others others others others others protocol others others others others others others
Because of this , and the fact that the attacked platforms include Apple macOS , we decided to call this Operation AppleJeus .		others others others others others others others others others others others others OS_name OS_name others others others others others others others malware others
Properties of the shady updater tool included in the package are :  MD5 :  b054a7382adf6b774b15f52d971f3799 .		others others others others others others others others others others others others others others md5 others
File Type :  PE32 executable ( GUI ) Intel 80386 , for MS Windows .		others others others others others others others others others others others others company OS_name others
Known file name :  %Program Files%\CelasTradePro\Updater.exe .		others others others others sample_name sample_name sample_name sample_name sample_name others
Link Time :  2018-06-15 10:56:27 UTC .		others others others time time time others
Build path :  Z:\jeus\downloader\downloader_exe_vs2010\Release\dloader.pdb .		others others others others others others others
The main purpose of Updater.exe is to collect the victim ’s host information and send it back to the server .		others others others others sample_name others others others others person others others others others others others others others others others others others
Upon launch , the malware creates a unique string with the format string template “ %09d-%05d ”  based on random values , which is used as a unique identifier of the infected host .		others others others others others others others others others others others others others others others string string string string others others others others others others others others others others others others others others others others others others
This malware collects process lists , excluding “ [ System Process ] ”  and “ System ”  processes and gets the exact OS version from the registry value at “ HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion ”  .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
It seems that such values only exist from Windows 10 , so we assume that the author developed and tested it on Windows 10 .		others others others others others others others others OS_name OS_name others others others others others others person others others others others others OS_name OS_name others
ProductName :  Windows OS version .		others others OS_name others others others
CurrentBuildNumber :  Windows 10 build version .		others others OS_name others others others others
ReleaseID :  Windows 10 version information .		others others OS_name others others others others
UBR :  Sub version of Windows 10 build .		others others others others others OS_name others others others
BuildBranch :  Windows 10 build branch information .		others others OS_name others others others others others
The code encrypts the collected information with the hardcoded XOR key ( “ Moz&Wie ; #t/6T!2y “ ) before uploading it to the server .		others others others others others others others others others encryption_algo encryption_algo others others others others others others others others others others others others others others others others others others others
The code sends the victim ’s information to a webserver using HTTP and the following URL : www.celasllc.com / checkupdate.php .		others others others others person others others others others others others others protocol others others others others others domain domain domain others
The server is a legitimate looking website owned by the developer of the program :  Celas LLC .		others others others others others others others others others others person others others others others company company others
At this point we were not able to conclude with high confidence whether the server was compromised by the threat actor or had belonged to the threat actor from the beginning .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
To learn more about the server , please read the “ Infrastructure ”  section below .		others others others others others others others others others others others others others others others others
The malware used a hardcoded User-Agent string “ Mozilla/5.0 ( compatible ;  MSIE 10.0 ;  Windows NT 6.1 ;  Trident/6.0 ) ”  and fixed a multipart form data separator string “ jeus “ .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others tool others others
Using encryption , the custom separator string wouldn ’t be a red flag for a legitimate application , but sending a request with the context-irrelevant string “ get_config ”  , as well as uploading collected system information as “ temp.gif ”  , mimicking a GIF image with a magic number in the header , definitely made us raise our eyebrows .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
After successfully uploading data , the updater checks the server response .		others others others others others others others others others others others others
If the server responds with HTTP code 300 , it means the updater should keep quiet and take no action .		others others others others others protocol others others others others others others others others others others others others others others others
However , if the response is HTTP code 200 , it extracts the payload with base64 and decrypts it using RC4 with another hardcoded key ( “ W29ab@ad%Df324V$Yd “ ) .		others others others others others others protocol others others others others others others others others others others others others others encryption_algo others others others others others others others others others others others others others others others others
The decrypted data is an executable file that is prepended with the “ MAX_PATHjeusD ”  string .		others others others others others others others others others others others others others others others others others
During our research , we found other similar files .		others others others others others others others others others others
One was created on August 3rd and another on August 11th .		others others others others time time others others others time time others
The PDB path shows that the author keeps improving this updater tool , apparently forked from some stable version released on July 2 , 2018 according to the internal directory name .		others others others others others others others others others others others others others others others others others others others others others time time time time others others others others others others others
4126e1f34cf282c354e17587bb6e8da3 0bdb652bbe15942e866083f29fb6dd62 .		md5 md5 others
2018-08-03 09:57:29 2018-08-13 0:12:10 .		time time time time others
ffae703a1e327380d85880b9037a0aeb bbbcf6da5a4c352e8846bf91c3358d5c .		md5 md5 others
2018-08-03 09:50:08 2018-08-11 7:28:08 .		time time time time others
H:\DEV\TManager\DLoader\20180702\dloader\WorkingDir\Output\00000009\Release\dloader.pdb H:\DEV\TManager\DLoader\20180702\dloader\WorkingDir\Output\00000006\Release\dloader.pdb .		others others others others others others others
Note the TManager directory in the PDB path from the table .		others others others others others others others others others others others others
It will pop up again in another unexpected place later .		others others others others others others others others others others others
For macOS users , Celas LLC also provided a native version of its trading app .		others OS_name person others company company others others others others others others others malware malware others
A hidden “ autoupdater ”  module is installed in the background to start immediately after installation , and after each system reboot .		others others others tool others others others others others others others others others others others others others others others others others others others
It keeps contacting the command and control ( C2 ) server in order to download and run an additional executable from the server .		reference_word others others others others others others others others others others others others others others others others others others others others others others others
The communication conforms to the Windows version of the updater and is disguised as an image file upload and download , while carrying encrypted data inside .		others others others others others OS_name others others others others others others others others others others others others others others others others others others others others others
We have analyzed the following installation file : MD5 :  48ded52752de9f9b73c6bf9ae81cb429 .		others others others others others others others others others others md5 others
File Size :  15,020,544 bytes .		others others others others others others
File Type :  DMG disk image .		others others others others others others others
Known file name :  celastradepro_mac_installer_1.00.00.dmg .		others others others others sample_name others
Date of creation :  13 July 2018 .		others others others others time time time others
Once the Cellas Trade Pro app is installed on macOS , it starts the Updater application on the system load via a file named “ .com.celastradepro.plist ”  ( note that it starts with a dot symbol , which makes it unlisted in the Finder app or default Terminal directory listing ) .		others others malware malware malware others others others others OS_name others reference_word others others sample_name others others others others others others others others others others sample_name others others others others others others others others others others others others others others others others others others others others others others others others others others
The “ Updater ”  file is passed the “ CheckUpdate ”  parameter on start .		others others sample_name others others others others others others tool others others others others others
The command-line argument “ CheckUpdate ”  looks redundant from a code analysis perspective :  there is no other argument that the application expects .		others others others others tool others others others others others others others others others others others others others others others others others others others
In the absence of all arguments , it doesn ’t do anything and quits .		others others others others others others others reference_word others others others others others others others others
This may or may not be way to trick sandboxes that could automatically execute this trojan updater , with no suspicious activity produced without such a “ secret ”  extra argument .		others others others others others others others others others others others others others others others malware malware others others others others others others others others others others others others others others others
The choice of a benign string such as “ CheckUpdate ”  helps it to hide in plain sight of any user or administrator looking into running processes .		others others others others others others others others others tool others others others others others others others others others others person others person others others others others others
The trojanized updater works similar to the Windows version in many ways .		others malware malware others others others others OS_name others others others others others
Both applications are implemented using a cross-platform QT framework .		others others others others others others others others others others
Upon launch , the downloader creates a unique identifier for the infected host using a “ %09d-%06d ”  format string template .		others others others malware malware others others others others others others others others others others others string string string string others others others others others
Next , the app collects basic system information , which for macOS is done via dedicated QT classes : Host name , OS type and version , System architecture , OS kernel type and version .		others others reference_word reference_word others others others others others others others OS_name others others others others others others others others others others others others others others others others others others others others others others others others
The process of encrypting and transferring data is the same as in the Windows version .		others others others others others others others others others others others others others OS_name others others
This information is XOR-encrypted with hardcoded 16-byte static key “ Moz&Wie ; #t/6T!2y ”  , prepended with GIF89a header and uploaded to the C2 server via HTTP POST and the following URL : https://www.celasllc.com/checkupdate.php .		others others others encryption_algo others others others others others others others others others others others others others others others others others others others others others others others others others others others protocol others others others others others others domain domain domain others
The module relies on a hardcoded User-Agent string for macOS :  User-Agent :  Mozilla/5.0 ( Macintosh ;  Intel Mac OS X 10_12_6 ) AppleWebKit/537.36  ( KHTML , like Gecko ) Chrome/66.0.3359.139 Safari/537.36 .		others others others others others others others others others OS_name others others others others others others others others others others others others others others others others others others others others others others others
Once the server replies , it checks the HTTP response code .		others others others others others others others others protocol others others others
HTTP response code 300 indicates that the server has no task for the updater and the application terminates immediately .		protocol others others others others others others others others others others others others others others others others others others others
If the HTTP response is code 200 , then the updater gets the data in the response , decodes it from base64 encoding and decrypts it using RC4 with the hardcoded static key “ W29ab@ad%Df324V$Yd “ .		others others protocol others others others others others others others others others others others others others others others others others others others others others others others others encryption_algo others others others others others others others others others others others others others others others
It calculates the MD5 of the decoded and decrypted data , which is compared to a value stored inside , to verify the integrity of the transferred file .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
After that , the payload is extracted and saved to a hardcoded file location “ /var/zdiffsec “ , sets executable permissions for all users and starts the app with another secret hardcoded command-line argument “ bf6a0c760cc642 “ .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Apparently the command-line argument is the way to prevent the detection of its malicious functionality via sandboxes or even reverse engineering .		others others others others others others others others others others others others others others others others others others others others others others
We have previously seen this technique adopted by Lazarus group in 2016 in attacks against banks .		others others others others others others others others threatActor_name others others time others others others target_crowd others
As of 2018 , it is still using this in almost every attack we investigated .		others others time others others others others others others others others others others others others others
According to data from Kaspersky Security Network , the threat actor delivered the malicious payload using one of the shadowy updaters described above .		others others others others security_team security_team security_team others others person person others others malware malware others others others others others others others others others
We found a malicious file created at the same host : MD5 :  0a15a33844c9df11f12a4889ae7b7e4b .		others others others others others others others others others others others others others md5 others
File Size :  104,898,560 bytes .		others others others others others others
File Type :  PE32+ executable ( GUI ) x86-64 , for MS Windows .		others others others others others others others others others others others company OS_name others
Known file name :  C:\Recovery\msn.exe .		others others others others others others others others
Link time :  2018-04-19 13:30:19 .		others others others time time others
Note the unusually large size for an executable file .		others others others others others others others others others others
We believe that it was inflated with junk data on purpose to prevent easy download or transfer over the internet .		others others others others others others others others others others others others others others others others others others others others others
Searching for the reason for the malware ’s appearance on the system revealed that there was an additional process responsible for producing several files before this malware was launched , suggesting a trojan dropper in action .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others malware others others others others
The main function of this malware is to implant the Fallchill backdoor loader linked to several files .		others others others others others others others others others others malware malware others others others others others others
Upon launch , the malware checks one of the command-line arguments passed to it .		others others others others others others others others others others others others others others others
The malware chooses one of the service names located in the following registry value as a disguise :  HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost\netsvcs .		others others others others others others others others others others others others others others others others others others others others others
This value includes a list of several dozen standard system service names .		others others others others others others others others others others others others others
The randomly chosen service name is used to name the dropped file and newly registered Windows service .		others others others others others others others others others others others others others others others OS_name others others
Let ’s refer to this randomly chosen service name as [ service ] .		others others others others others others others others others others others others others others others
The malware contains references to several files inside :  The file passed as argument : contains a 16-byte key .		others others others others others others others others others others others others others others others others others others others others
msncf.dat :  Encrypted configuration data .		sample_name others others others others others
msndll.tmp :  Encrypted Fallchill loader .		sample_name others others malware others others
msndll.dat :  Encrypted Fallchill backdoor ( payload for the loader ) .		sample_name others others malware malware others others others others others others others
[service]svc.dll :  Fallchill backdoor loader .		others others others others others malware malware others others
[service].dat :  Copy of msndll.dat .		others others others others others others others sample_name others
A mix of the above-mentioned files produces the final backdoor known as Fallchill .		others others others others others others others others others others others others malware others
A more detailed procedure for technical specialists is as follows :  Check whether the command-line argument points to a file of 16 byte size .		others others others others others others others others others others others others others others others others others others others others others others others others others
Read the file passed via the command-line argument .		others others others others others others others others others
The contents of this file contains a crypto key , which we will call the main key .		others others others others others others others others others others others others others others others others others others
Open the msncf.dat file ( configuration file ) .		others others sample_name others others others others others others
If the file size equals 192 bytes , read the content of the file .		others others others others others others others others others others others others others others others
Open msndll.tmp file and decrypt it using the main key .		others sample_name others others others others others others others others others
Create the [service]svc.dll file and fill it with pseudo-random data .		others others others others others sample_name others others others others others others others others
The malware fills the file with 10,240 bytes of pseudo-random data , and iterates ( rand() % 10 + 10240 ) times .		others others others others others others others others others others others others others others others others others others others others others others others others others
This is why it produces files which are at least 104,851,000 bytes .		others others others others others others others others others others others others others
Copy the 16-byte main key at the end of the [service]svc.dll file .		others others others others others others others others others others others others others sample_name others others
Encrypt the [service].dat file name with the main key and append it at the end of [service]svc.dll .		others others others others others others others others others others others others others others others others others others others others others others others others
Overwrite the beginning of [service]svc.dll with data decrypted from msndll.tmp .		others others others others others others others others others others others others sample_name others
Move msndll.dat file to [service].dat .		others sample_name others others others others others others others
Delete temporary files : msndll.tmp , msncf.dat , msndll.log .		others others others others sample_name others sample_name others sample_name others
Timestamp [service]svc.dll and [service].dat files .		others others others others others others others others others others others others
Register [service]svc.dll as a Windows service .		others others others others others others others others others others
Save a copy of data from msncf.dat file in the following registry value HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\TaskConfigs\Description .		others others others others others others others others others others others others others others others
We confirmed that the following malware was created on the infected host using the method described above :  Fallchill backdoor loader :  MD5 :  e1ed584a672cab33af29114576ad6cce .		others others others others others others others others others others others others others others others others others others malware malware others others others others md5 others
File Size :  104,878,356 bytes .		others others others others others others
File Type :  PE32+ executable ( DLL ) ( console ) x86-64 , for MS Windows .		others others others others others others others others others others others others others others others others others
Known file name :  C:\Windows\system32\uploadmgrsvc.dll .		others others others others others others others others
Link time :  2018-01-18 01:56:32 .		others others others time time others
Encrypted Fallchill backdoor :   MD5 :  d8484469587756ce0d10a09027044808 .		others malware malware others others others md5 others
File Size :  143,872 bytes .		others others others others others others
File Type :  encrypted data .		others others others others others others
Known file name :  C:\Windows\system32\uploadmgr.dat .		others others others others others others others others
Upon starting , uploadmgrsvc.dll reads 276 bytes from the end of its own executable file .		others others others sample_name others others others others others others others others others others others others
The first 16 bytes of this 276-byte data are used as a decryption key , and the remaining 260 bytes contain the encrypted file path used by the backdoor .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
After decryption of the last 260-bytes , the malware retrieves the name or path of the file that contains the actual backdoor body in encrypted form .		others others others others others others others others others others others others others others others others others others others others others malware others others others others others
The malware reads the specified file and decrypts it using the same decryption routine .		others others others others others others others others others others others others others others others
This is how the executable code of the backdoor is produced in memory and executed by the loader .		others others others others others others others others malware others others others others others others others others others others
Below is the meta information about the decrypted final payload in memory :  MD5 :  d7089e6bc8bd137a7241a7ad297f975d .		others others others others others others others others others others others others others others others md5 others
File Size :  143,872 bytes .		others others others others others others
File Type :  PE32+ executable ( DLL ) ( GUI ) x86-64 , for MS Windows .		others others others others others others others others others others others others others others others others others
Link Time :  2018-03-16 07:15:31 .		others others others time time others
We can summarize the Fallchill backdoor loading process as follows :  As mentioned previously , the final payload belongs to a Fallchill malware cluster formerly attributed to the Lazarus APT group .		others others others others malware others others others others others others others others others others others others others others others others malware others others others others others others threatActor_name attack_activity others others
Upon launching , this malware resolves the API function addresses at runtime , and reads the C2 server address from the registry value created during the installation stage :  HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\TaskConfigs\Description .		others others others others others others others function others others others others others others others others others others others others others others others others others others others others others others others
If there is no configuration value , the malware falls back to a default C2 server address .		others others others others others others others others others others others others others others others others others others
196.38.48.121 .		IP others
185.142.236.226 .		IP others
This is a full-featured backdoor that contains enough functions to fully control the infected host .		others others others others malware others others others others others others others others others others others
Some of its network protocol commands are described below .		others others others others others others others others others others
This set of capabilities is very common for many Lazarus backdoors , which have been seen in other attacks against banks and financial industry in the past years .		others others others others others others others others others threatActor_name malware others others others others others others others others others industry others industry others others others others others others
While working on the incident of the cryptocurrency company ’s breach , we were curious about the legal status of the Celas LLC company that developed this trojanized trading application .		others others others others others others others others others others others others others others others others others others others others others others company company others others others others malware malware malware others
The website had a valid SSL certificate issued by Comodo CA .		others others others others others protocol others others others company company others
However , note that the certificate from this webserver mentions “ Domain Control Validated ”  , which is a weak security verification level for a webserver .		others others others others others others others others others others others others others others others others others others others others others others others others others others others
It does not mean validation of the identity of the website ’s owner , nor of the actual existence of the business .		others others others others others others others others others others others others others others others others others others others others others others others others
When certification authorities issue this kind of certificate they only check that the owner has a certain control over the domain name , which can be abused in certain ways .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Below is the WHOIS record of the “ celasllc.com ”  domain .		others others others protocol others others others others domain others others others
The domain name was registered by an individual named “ John Broox ”  with registrant email address “ johnbroox200@gmail.com ”  .		others others others others others others others others others others person person others others others others others others email_evil email_evil email_evil others others
The same name of “ John Broox ”  was used inside the installation package of the macOS version of the trading application .		others others others others others person person others others others others others others others others others OS_name others others others others others others
The Info.plist properties file describes the package as follows :  It looks at first sight like a legitimate WHOIS record , but something doesn ’t really add up here .		others sample_name others others others others others others others others others others others others others others others others protocol others others others others others others others others others others others others
The domain celasllc.com was the only domain registered with this email address and was exclusively used for domain registration .		others others domain others others others others others others others others others others others others others others others others others
The registrant used the Domain4Bitcoins service to register this domain , apparently paying with cryptocurrency .		others others others others others others others others others others others others others others others others
According to open-source intelligence , the address of the WHOIS information is fake , unless it ’s the owner of a ramen shop running a cryptocurrency exchange software development studio on the side .		others others others others others others others others others protocol others others others others others others others others others others others others others others others others others others others others others others others others others
The server hosting celasllc.com ( 185.142.236.213 ) belongs to the Blackhost ISP in the Netherlands .		others others others domain others IP others others others others company company others others location others
Coincidentally , the Fallchill malware authors also preferred to use the same hosting company to host their C2 server .		others others others malware others person others others others others others others others others others others others others others others
Moreover , the Celas LLC web server and one of the C2 servers of the Fallchill malware are located in the same network segment of this ISP :  Celas LLC infrastructure :   185.142.236.213 :  Netherlands Blackhost Ltd. AS174 COGENT-174 .		others others others company company others others others others others others others others others others malware others others others others others others others others others others others others government government others others IP others location company others others others others
Fallchill malware C2 server :   196.38.48.121 :  South Africa Internet Solutions AS3741 .		malware others others others others IP others location location others others others others
185.142.236.226 :  Netherlands Blackhost Ltd. AS174 COGENT-174 .		IP others location company company others others others
Additional attacker ’s server from telemetry .		others person others others others others others others
80.82.64.91 :  Seychelles Incrediserve Ltd AS29073 .		IP others location others others others others
185.142.239.173 :  Netherlands Blackhost Ltd. AS174 COGENT-174 .		IP others location company others others others others
However , when you look into Celas Trading Pro application ’s digital signature , including its “ Updater ”  , you will find that this certificate was also issued by Comodo CA , which refers to a company address in the United States .		others others others others others others company others others others others others others others others others others others others others others others others others others others others others others others others company company others others others others others others others others others location location others
According to open-source data , this address doesn ’t belong to a real business , and looks on maps like a meadow with a small forest and small real estate offering nearby .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Pivoting the infrastructure a little further brings up some more suspicious things .		others others others others others others others others others others others others others
It appears that the domain referred to two IPs , one of which was linked to a few other suspicious domains , according to PassiveDNS .		others others others others others others others others others others others others others others others others others others others others others others others others others others
The owners of the linked infrastructural elements preferred to use several interesting services for hosting domain registration .		others others others others others others others others others others others others others others others others others others
All these service providers offer a certain level of anonymity to their customers .		others others others person others others others others others others others others person others
Most of them accept Bitcoins as a main payment method to keep their customers anonymous .		others others others others others others others others others others others others others person others others
This is very uncommon for companies running a legitimate business .		others others others others others others others others others others others
Hosting services linked to Celas LLC :  Blackhost ( https://black.host/ ) .		others others others others company company others url others url url url others others
Liberty VPS  ( https://libertyvps.net/ ) .		url url others url url url others others
Domain registration services linked to Celas LLC : Domains4Bitcoins ( https://www.domains4bitcoins.com/ ) .		others others others others others company company others domain others domain domain domain others others
NameCheap ( https://www.namecheap.com/ ) .		domain others domain domain domain others others
ChangeIP ( https://www.changeip.com / ) .		domain others domain domain domain domain others others
Njalla ( https://njal.la/ ) .		domain others domain domain domain others others
All the facts above can make the more sceptical among us doubt the intentions of Celas LLC and the legitimacy of this business .		others others others others others others others others others others others others others others others company company others others others others others others others
Of course , these facts alone would not be enough to accuse Celas LLC of committing a crime .		others others others others others others others others others others others others company company others others others others others
Kaspersky Lab has previously attributed the Fallchill malware cluster to Lazarus group when it attacked the financial sector around the world .		security_team security_team others others others others malware others others others threatActor_name others others others others others target_crowd target_crowd others others others others
It was also confirmed by other security vendors , and the national CERT of US .		others others others others others others others others others others others others security_team others location others
Fallchill malware uses a RC4 algorithm with a 16-byte key to protect its communications .		malware others others others encryption_algo others others others others others others others others others others
The key extracted from the Fallchill variant used in the current attack is DA E1 61 FF 0C 27 95 87 17 57 A4 D6 EA E3 82 2B .		others others others others others malware others others others others others others others string string string string string string string string string string string string string string string string others
We were able to confirm that some of older Fallchill malware variants used exactly the same RC4 key .		others others others others others others others others others malware others others others others others others encryption_algo others others
Below are Fallchill malware samples that used the same key ( the compilation timestamp may indicate the date of malware creation ) .		others others malware others others others others others others others others others others others others others others others others others others others others
81c3a3c5a0129477b59397173fdc0b01 2017-05-26 23:37:04 .		md5 time time others
6cb34af551b3fb63df6c9b86900cf044 2017-06-09 17:24:30 .		md5 time time others
21694c8db6234df74102e8b5994b7627 2017-11-07 17:54:19 .		md5 time time others
5ad7d35f0617595f26d565a3b7ebc6d0 2015-10-24 01:52:11 .		md5 time time others
c501ea6c56ba9133c3c26a7d5ed4ce49 2017-06-09 03:59:43 .		md5 time time others
cafda7b3e9a4f86d4bd005075040a712 2017-11-07 17:54:33 .		md5 time time others
cea1a63656fb199dd5ab90528188e87c 2017-06-12 19:25:31 .		md5 time time others
6b061267c7ddeb160368128a933d38be 2017-11-09 17:18:06 .		md5 time time others
56f5088f488e50999ee6cced1f5dd6aa 2017-06-13 08:17:51 .		md5 time time others
cd6796f324ecb7cf34bc9bc38ce4e649 2016-04-17 03:26:56 .		md5 time time others
We have confirmed that the C2 server addresses ( 196.38.48.121 , 185.142.236.226 ) used in this attack have been used by the older variant of Fallchill .		others others others others others others others others others IP others IP others others others others others others others others others others others others others malware others
94dfcabd8ba5ca94828cd5a88d6ed488 2016-10-24 02:31:18 .		md5 time time others
14b6d24873f19332701177208f85e776 2017-06-07 06:41:27 .		md5 time time others
abec84286df80704b823e698199d89f7 2017-01-18 04:29:29 .		md5 time time others
Apparently , the attackers using the Fallchill malware continue to reuse code and C2 server infrastructure over and over again .		others others others person others others malware others others others others others others others others others others others others others others
According to Kaspersky Security Network , Fallchill was not the only malware used in this attack .		others others security_team security_team security_team others malware others others others others others others others others others others
There was another backdoor that was used by the threat actor .		others others others malware others others others others others person person others
We omit a full description of this backdoor in the current report to keep the write-up to an acceptable length , but we would like to highlight two important things discovered in it .		others others others others others others others malware others others others others others others others others others others others others others others others others others others others others others others others others others others
First , this backdoor was created on 2018-07-12 and revealed an already familiar directory , “ TManager ”  , which we previously saw in the Updater.exe application from the Cellas Trading Pro suite :  H:\DEV\TManager\all_BOSS_troy\T_4.2\T_4.2\Server_\x64\Release\ServerDll.pdb .		others others others malware others others others time others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Second , what is probably one of the most interesting findings to come from this additional backdoor was discovered hidden in hardcoded headers used to communicate with C2 server .		others others others others others others others others others others others others others others others others malware others others others others others others others others others others others others others
The Accept-Language HTTP header string revealed a language code associated with North Korea .		others others protocol others others others others others others others others location location others
In our experience , this is something we normally don ’t see in malware .		others others others others others others others others others others others others others others others others
Accept-Language :  ko-kp ,ko-kr ; q=0.8 ,ko ; q=0.6 ,en-us ; q=0.4 ,en ; q=0.2 .		others others others others others others others others others others others others others others others others others others others others
The Lazarus APT group ’s continuous attacks on the financial sector are not much of a surprise to anyone .		others person person person others others others others others others target_crowd target_crowd others others others others others others others others others
A lot of research has been done and published about such attacks .		others others others others others others others others others others others others others
However , we think this case makes a difference .		others others others others others others others others others others
Recent investigation shows how aggressive the group is and how its strategies may evolve in the future .		others others others others others reference_word reference_word others others others others others others others others others others others
First of all , Lazarus group has entered a new platform :  macOS .		others others others others threatActor_name others others others others others others others OS_name others
There is steadily growing interest in macOS from ordinary users , especially in IT companies .		others others others others others others OS_name others others person others others others company company others
Many developers and engineers are switching to using macOS .		others person others person others others others others OS_name others
Apparently , in the chase after advanced users , software developers from supply chains and some high profile targets , threat actors are forced to have macOS malware tools .		others others others others others others person person others person person others others others others others others others others others person person others others others others OS_name others others others
We believe that in the future Lazarus is going to support all platforms that software developers are using as a base platform , because compromising developers opens many doors at once .		others others others others others others threatActor_name others others others others others others others person others others others others others others others others others person person others others others others others others
We cannot say with full certainty whether Celas LLC was compromised and the threat actor abused it to push malware through an update mechanism .		others others others others others others others others company company others others others others person person others reference_word others others others others others others others others
However , the multiple successful Lazarus attempts to compromise supply chain companies suggest that it will keep exploring this infection method .		others others others others others threatActor_name others others others target_crowd target_crowd target_crowd others others reference_word others others others others others others others
From all angles , the Celas LLC story looks like the threat actor has found an elaborate way to create a legitimate looking business and inject a malicious payload into a “ legitimate looking ”  software update mechanism .		others others others others others company company others others others others person person others others others others others others others others others others others others others others others others others others others others others others others others others others
Sounds logical :  if one cannot compromise a supply chain , why not to make fake one ?		others others others others others others others others others others others others others others others others others others others
This should be a lesson to all of us and a wake-up call to businesses relying on third-party software .		others others others others others others others others others others others others others others others others others others others others
Do not automatically trust the code running on your systems .		others others others others others others others others others others others
Neither good looking website , nor solid company profile nor the digital certificates guarantee the absence of backdoors .		others others others others others others others others others others others others others others others others others malware others
Trust has to be earned and proven .		others others others others others others others others
Stay safe !		others others others
Lazarus :  www.celasllc.com/checkupdate.php ( malware distribution URL ) .		threatActor_name others others others others others others others others
Lazarus :  196.38.48.121 .		threatActor_name others IP others
Lazarus :  185.142.236.226 .		threatActor_name others IP others
Lazarus :  80.82.64.91 .		threatActor_name others IP others
Lazarus :  185.142.239.173 .		threatActor_name others IP others