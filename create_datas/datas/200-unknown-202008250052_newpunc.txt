HOT KNIVES THROUGH BUTTER: Evading File-based Sandboxs .		others others others others others others others tool others
HOT KNIVES THROUGH BUTTER: Evading File-based Sandboxs .		others others others others others others others others others
If the sandbox does not have the targeted version installed, the malicious flash file is not downloaded, and the sandbox detects no malicious activity .		others others tool others others others others others others others others others others others others others others others others others others others others others others others others
The code executes only on systems that have the targeted version—in this case, version 6.0 or later—bypassing sandboxes that do not have a matching version in place .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others
Often, malware uses seemingly innocuous files to get past defenses and download a malicious payload .		others others others others others others others others others others others others others others others others others
A common approach is hiding iframe HTML elements in an otherwise non-executable file, such as a GIF picture or Acrobat Flash .		others others others others others others program_language others others others others others others others others others others others others others others others others
By themselves, these files are not executed and therefore exhibit no suspicious behavior in the sandbox .		others others others others others others others others others others others others others others others others tool others
Instead, they hide data—this data is “unlocked” and executed by a separate file that waits for it on a compromised physical computer .		others others others others others others others others others others others others others others others others others others others others others others others others others others
The footer is a single-field block indicating the end of the GIF data stream .		others others others others others others others others others others others others others others others
It normally has a fixed value 0x3B.		others others others others others others others others
In many malicious GIF files, an iframe tag is added after the footer .		others others others others others others others others others others others others others others others
Flash is not an HTML rendering engine, so the hidden iframe does nothing when the Flash file is opened in the sandbox .		others others others others program_language others others others others others others others others others others others others others others others others others tool others
So again, the sandbox detects no malicious behavior .		others others others others tool others others others others others
In the same way, JPEG files can contain hidden data that flies under the radar of file-based sandboxes .		others others others others others others others others others others others others others others others others others others tool others
Normally, the PHP command Exif_read_data is used to read images .		others others others program_language others others others others others others others others
Another PHP command, preg_ replace, lets programmers find and replace the content of strings .		others program_language others others others others others others others others others others others others others others others
But preg_replace has an option that executes content rather than just searching and replacing .		others others others others others others others others others others others others others others others
(This option, eval, is triggered with the command modifier “/e/”.)		others others others others others others others others others others others others others others others others others
.		others
The eval function allows attackers on a compromised website to execute malicious PHP commands hidden in the JPEG header .		others others others others others others others others others others others others program_language others others others others others others others
File-based sandboxes typically open JPEG files in a file viewer or Web browser .		others others others others others others others others others others others others others others
Absent any PHP commands to execute the hidden code in the sandbox, the JPEG file exhibits no malicious behavior .		others others program_language others others others others others others others others others others others others others others others others others others
In addition to containing iframe tags, images such as like GIF, PNG can also store hidden executables .		others others others others others others others others others others others others others others others others others others others others
The gif file has a single byte xored executable .		others others others others others others others others others others
The key to decode the executable is 0x75 .		others others others others others others others others others
When the image file is moved to a file-based sandbox, the sandbox opens it in an image viewer or Web browser .		others others others others others others others others others tool others others tool others others others others others others others others others others
Because the hidden executable does not run in a Web browser or image viewer, the sandbox never sees any malicious behavior and deems the file benign .		others others others others others others others others others others others others others others others others tool others others others others others others others others others others others
Usually, running a dynamic-link library (DLL) file involves using run32dll.exe or loading the DLL in a process that executes it .		others others others others others others others others others others others others others others others others others others others others others others others others
Some malware uses a different process, requiring specific loaders to execute the DLL .		others others others others others others others others others others others others others others others
If the required loader is not present, the DLL does not execute and remains undetected by the sandbox .		others others others others others others others others others others others others others others others others others others tool others
The sandbox-evasion techniques outlined so far in this report are hallmarks of advanced malware and APTs .		others others others others others others others others others others others others others others others others others
But based on our telemetry data, several classic evasion techniques continue to prove useful to malware writers .		others others others others others others others others others others others others others others others others others others others
VMware, a popular virtual-machine tool, is particularly easy to detect because of its distinctive configuration .		tool others others others others others others others others others others others others others others others others others
To detect the presence of a VMware-created sandbox, some malware checks for services unique to VMware, including vmicheatbeat, vmci, vmdebug, vmmouse, vmscis, VMTools, vmware, vmx86, vmhgfs, and vmxnet .		others others others others others others others tool others others others others others others others others tool others others others others others others others others others others others others others others others others others others others others others others others