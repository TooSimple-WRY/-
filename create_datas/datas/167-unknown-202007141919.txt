iranian-fileless-cyberattack-on-israel-word-vulnerability Release_Time : 2017-04-27 .		others others others others others
Report_URL : https://blog.morphisec.com/iranian-fileless-cyberattack-on-israel-word-vulnerability .		others others others others others others
From April 19-24 , 2017 , a politically-motivated , targeted campaign was carried out against numerous Israeli organizations .		others time time time time others others others others others others others others others others others industry industry others
Morphisec researchers began investigating the attacks on April 24 and continue to uncover more details .		security_team others others others others others others time time others others others others others others others
Initial reports of the attacks , published April 26 ( in Hebrew ) by the Israel National Cyber Event Readiness Team ( CERT-IL ) and The Marker , confirm that the attack was delivered through compromised email accounts at Ben-Gurion University and sent to multiple targets across Israel .		others others others others others others others time time others others others others others others security_team security_team security_team security_team security_team security_team security_team security_team security_team others security_team security_team others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others location others
Ironically , Ben-Gurion University is home to Israel ’s Cyber Security Research Center .		others others others others others others others security_team security_team security_team security_team security_team security_team security_team others
Investigators put the origin of the attack as Iranian ; Morphisec ’s research supports this conclusion and attributes the attacks to the same infamous hacker group responsible for the OilRig malware campaigns .		others others others others others others others others others others security_team others others others others others others others others others others others others others threatActor_aliases threatActor_aliases threatActor_aliases others others others attack_activity attack_activity attack_activity others
The fileless attack was delivered via Microsoft Word documents that exploited a former zero-day vulnerability in Word , CVE-2017-0199 , to install a fileless attack variant of the Helminth Trojan agent .		others attack_activity attack_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others vulnerability_cve others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity malware malware malware others
Microsoft released the patch for the vulnerability on April 11 , but many organizations have not yet deployed the update .		company others others counter_measure counter_measure counter_measure counter_measure others time time others others others others others others others others others others others
The attackers actually based their attack on an existing Proof-of-Concept method that was published by researchers after the patch release .		others others others others others reference_word others others others function others others others others others others others others others others others
By hunting through known malware repositories , Morphisec identified matching samples uploaded by Israeli high-tech development companies , medical organizations and education organizations , indicating that they were victims of the attack .		others counter_measure counter_measure counter_measure counter_measure counter_measure others security_team others others others others others others industry industry industry others industry industry others industry industry others others others others others others others others reference_word others
For security purposes , Morphisec is not revealing these names .		others others others others security_team others others others others others others
The delivery was executed by compromising the email accounts of a few high-profile individuals at Ben-Gurion University .		others others others others others sub_activity sub_activity sub_activity sub_activity others others others target_crowd target_crowd target_crowd target_crowd target_crowd others
The Word document was sent as a reply to legitimate emails sent from those accounts and was propagated to more than 250 individuals in different Israeli companies , according to CERT-IL .		others others others others others others others others others others others others others others others others others others others others others target_crowd target_crowd target_crowd target_crowd target_crowd target_crowd others others others security_team others
Upon deeper investigation into the installed Helminth fileless agent , we identified a near perfect match to the OilRig campaign executed by an Iranian hacker group against 140 financial institutions in the Middle East last year , as analyzed by FireEye , Palo Alto Networks and Logrhythm .		others others others others others others malware malware malware others others others others others others others others others attack_activity attack_activity others others others threatActor_aliases threatActor_aliases threatActor_aliases others others industry industry others others location location others others others others others others security_team others security_team security_team security_team others security_team others
This group has become one of the most active threat actors , with noteworthy abilities , resources and infrastructure ; speculations indicate the hacking organization to be sponsored by the Iranian government .		reference_word reference_word others others others others others others others others others others others others others others others others others others others others reference_word reference_word reference_word others others others others others government government others
In other recent attacks ( January 2017 ) , the group used a fake Juniper Networks VPN portal and fake University of Oxford websites to deliver malware as described by ClearSky .		others others others others others time time others others reference_word reference_word others others tool tool tool tool tool others tool tool tool tool tool others attack_activity attack_activity others others others malware others
13.doc: a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab .		sample_name others sha2 others
558.doc,2.doc: 2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a84 .		others others sha2 others
1.doc: 832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d8 .		sample_name others sha2 others
3.doc: d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e48 .		sample_name others sha2 others
The most notable difference from last year ’s OilRig campaign is the way the attack was delivered .		others others others others others others others others others attack_activity attack_activity others others others others others others others others
In the previous campaign , the Iranian group sent specially crafted Excel and Word files , which contained macros that targeted individuals were convinced to enable .		others others others others others threatActor_aliases threatActor_aliases threatActor_aliases others others others tool tool tool tool others others others malware others others others others others others others others
test4.hta hxxp://comonscar.in  ( 82.145.40.46 ) .		others domain_evil domain_evil domain_evil others IP_evil others others
test5.hta 80.82.67.42. test1.hta reserved .		others others others others others
The .hta file is immediately executed by mshta.exe , the Windows process which executes html executables .		others others others others others others others sample_name others others OS_name others others others others others others
The HTA execution goes through the following steps : Before installing the agent , the .hta file sends the “ Enter ” key into the Word application to remove the warning message and minimize any appearance of suspicious execution .		attack_activity attack_activity attack_activity others others others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others others others others others
It is done by creating and executing a 1.vbs script .		others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
The next step writes and executes the 0011.ps1 PowerShell script , which is described in the following section .		others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others
The last step kills the original process that activated the .hta file , to remove any suspicion .		others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others
0011.ps1 script , which is activated by the .hta file , is in charge of generating the Helminth Trojan PowerShell and VBS files .		malware malware others others others others others others others others others others others others others others others malware malware malware malware malware malware others
0011.ps1 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509DB92029D1 .		others sha2 others
1.vbs BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77981976ED .		others sha2 others
This structure matches the attack structure from October 2016 , as described by Logrhythm .		others others others others others others others time time others others others others attack_activity others
Aside the unique generation of the files , the structure and the functionality of the trojan is very similar to the previous campaign : The PowerShell script ps1 creates similar variants of Helminth trojan PowerShell and VBS files templates ( DnS1.Ps1 , DnE1.Ps1 , backup1.vbs ) .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others malware malware malware malware malware malware malware others malware others malware others malware others others
As in the previous campaign , persistency is achieved by adding a schedule task with a similar name to the Google update task ( “ GoogleUpdateTasksMachineUI ” ) , which executes vbs every 3 minutes .		others others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others others others others others
We will focus here on the DnE1.Ps1 file because all other files are almost identical to the previous campaign .		others others others others others others malware others others others others others others others others others others others others others
This file executes some of the same commands executed by VBS script in the previous campaign , but there are differences as well .		reference_word reference_word sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others others others others others
The script connects to a C&C server – vpsupdate[.		others others others others others others others others others others domain_evil domain_evil domain_evil
]tk .		domain_evil domain_evil others
At the time of this report ’s publication , the C&C server is still live ; the server was first registered on April 16 , 2017 .		others others others others others others others others others others others others others others others others others others others others others others others others others time time time time others
The goal of the script is to : Download bat script , Execute it and upload the results back to the C&C , Clear traces .		others others others others others others others others attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal others
At each new activation ( first ) activation of the download command ( GET request ) , the infected computer receives a bat script for activation from the C&C : vpsupdate.tk/index.aspx?id=<random character><randomnumber>[b] ( the “ b ” is for download ) .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others others others others others others others others others others
Back to the popular variant of the protocol : As soon as the file executes and the result output is written to default.bat.txt ( similarly to the previous campaign ) , the resulting file is uploaded back to the C&C using the following URL command ( POST request ) : vpsupdate.tk/index.aspx?id=<random character><randomnumber>[u] ( the “ u ” is for upload ) .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil url_evil others others others others others others others others others others
At the same time , the DnE1.Ps1 is executed .		others others others others others others malware others others others
The DnS1.Ps1 is also executed and communicates with the C&C using DNS exchange queries ( the same as in the previous campaign ) .		others malware others others others others others others others others others others others tool tool tool others others others others others others others others others others
The bat script is a customized version of Mimikatz ( with slight modification from the last campaign ) .		others others others others others others others others malware others others others others others others others others others others
Its goal is to gather information from the computer and the network .		others others others others attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal attack_goal others
The added commands are chcp to handle non-ASCII characters and the validation of the scheduled task ( which should have been added by the persistency mechanism ) .		others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others others function function others others
In that case , the information that is gathered includes A.V.		others others others others others others others others others others sample_name sample_name
, Firewall and AntiSpy product information .		others sample_name others sample_name others others others
The persistent tasks are slightly different as well , “ Google Update Core ” and “ Google Sync Core ” .		others others others others others others others others others others others others others others others others others others others others others
The scheduled task “ GoogleUpdateTasksMachineUI ” should be removed .		counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure others
Note that regular Google update tasks look like GoogleUpdateTask[Machine|User]* without the “ s ” in Tasks ) .		others others others others others others others others sample_name sample_name sample_name sample_name others others others others others others others others others others
In case “ Google Update Core ” or “ Google Sync Core ” exists , those need to be removed as well .		counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure others others others
If the following directory exists , remove it : “ Program Files (x86 )\Microsoft Idle ” .		others others others others others others counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure others
If the following directory contains “ WinInit.lnk ” or “ SyncInit.lnk ” files , remove those files : “ %userprofile%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup ” .		others others others others others others others others others others others others others others counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure counter_measure others
Every few years , a new “ logic bug ” CVE in OLE object linking is identified ; the previous one was three years ago ( CVE-2014-4114 and CVE-2014-6352 ) .		others others others others others others others others others others others others others others others others others others others others others others others others others others vulnerability_cve others vulnerability_cve others others
It allows attackers to embed OLE objects ( or links in the case of CVE-2017-0199 ) and bypass Microsoft validation of OLE execution without warning .		others others others others others others others others others others others others others others vulnerability_cve others others others others others others others others others others others
It is significant to note how the Iranian threat actors advanced their abilities in such a short time : Utilizing a vulnerability PoC immediately after its publication , Setting up the required infrastructure with multiple domains and delivery servers , Increasing the sophistication of the delivered Helminth agent , including regeneration of its signatures on the infected computer , Improving the customized information gathering Mimikatz version .		others others others others others others threatActor_aliases threatActor_aliases threatActor_aliases threatActor_aliases others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
With many organizations taking high-risk vulnerabilities seriously and patching them as quickly as possible , attackers can no longer exploit them for an extended period of time .		others others others others others others others others others others others others others others others others others others others others others others others others others others others others
We therefore expect that threat actors will return to macro-based campaigns like Hancitor .		others others others others others others others others others others others others attack_activity others
fileless attack : a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab .		attack_activity attack_activity others sha2 others
fileless attack : 2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a84 .		attack_activity attack_activity others sha2 others
fileless attack : 832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d8 .		attack_activity attack_activity others sha2 others
fileless attack : d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e48 .		attack_activity attack_activity others sha2 others
fileless attack : 5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220ac43 .		attack_activity attack_activity others sha2 others
fileless attack : 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509DB92029D1 .		attack_activity attack_activity others sha2 others
fileless attack : BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77981976ED .		attack_activity attack_activity others sha2 others
fileless attack : hxxp://comonscar.in  ( 82.145.40.46 ) .		attack_activity attack_activity others domain_evil domain_evil domain_evil others IP_evil others others
fileless attack : 80.82.67.42. fileless attack : vpsupdate.tk .		attack_activity attack_activity others others attack_activity attack_activity others domain_evil others
fileless attack : alenupdate.info .		attack_activity attack_activity others domain_evil others
fileless attack : Maralen.tk .		attack_activity attack_activity others domain_evil others
fileless attack : GoogleUpdateTasksMachineUI .		attack_activity attack_activity others sample_name others
fileless attack : Google Update Core .		attack_activity attack_activity others sample_name sample_name sample_name others
fileless attack : Google Sync Core .		attack_activity attack_activity others sample_name sample_name sample_name others