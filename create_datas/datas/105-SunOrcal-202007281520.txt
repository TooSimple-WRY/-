New Malware with Ties to SunOrcal Discovered .		others others others others others malware others others
Release_Time :  2017-11-10 Report_URL :  https://unit42.paloaltonetworks.com/unit42-new-malware-with-ties-to-sunorcal-discovered/ Unit 42 has discovered a new malware family we've named "Reaver" with ties to attackers who use SunOrcal malware .		others others others others others others others others security_team security_team others others others others others others others others others others malware others others others others person others others malware others others
SunOrcal activity has been documented to at least 2013 , and based on metadata surrounding some of the C2s , may have been active as early as 2010 .		malware others others others others others others others time others others others others sub_activity others others others others tool others others others others others others others others time others
The new family appears to have been in the wild since late 2016 and to date we have only identified 10 unique samples , indicating it may be sparingly used .		reference_word reference_word reference_word others others others others others others others others others time others others others others others others others others others others others others others others others others others others
Reaver is also somewhat unique in the fact that its final payload is in the form of a Control panel item , or CPL file .		malware others others others others others others others others others tool tool others others others others others others tool tool others others others tool others others
To date , only 0.006% of all malware seen by Palo Alto Networks employs this technique , indicating that it is in fact fairly rare .		others others others others others others others others sub_activity others others company company company others reference_word reference_word others others others others others others others others others others
While we don't have information on the intended targets in this case , previous reports on this activity have identified targeting primarily among the "Five Poisons" which are movements the Chinese government perceives as dangerous .		others others others others others others others others others others others others others others others others others others others others others others others others others others sub_activity sub_activity others others others others others government government others others others others
They are :  Uyghurs , particularly those supporting East Turkestan independence , Tibetans , particularly those supportive of Tibetan independence , Falun Gong practitioners , Supporters of Taiwan independence , Supporters of Chinese democracy .		reference_word others others person others others others others location location others others person others others others others others location others others person person person others person person location person others person person person person others
The attackers used both families concurrently from late last year through November 2017 and there is some C2 infrastructure overlap between the two families , as well as links to historical reporting .		others person others others others others others others others others others time time others others others others tool sub_activity others others others others others others others others others others others others others others
To date , Palo Alto Networks Unit 42 has identified 10 unique samples and three distinct variants of a new malware family we have named "Reaver" .		others others others company company company security_team security_team others others sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity others others others others others others others others others malware others others
As such , we identify each variant as Reaver.v1 , Reaver.v2 , and Reaver.v3 .		others others others others others others others others sample_name others sample_name others others sample_name others
Reaver.v1 has been observed delivering a payload that uses HTTP for network communication , while versions 2 and 3 use a payload that uses raw TCP connections for this communication .		sample_name others others others others others tool others others protocol others sub_activity sub_activity others others others others others others others others tool others others others protocol others others sub_activity sub_activity others
The earliest variant of Reaver begins by attempting to enable the SeDebugPrivilege privilege for the running process .		others others others others malware others others others others sub_activity sub_activity tool sub_activity others others sub_activity sub_activity others
In the event this is successful the malware will use the following path to store any dropped files :  %COMMONPROGRAMFILES%\services\ .		others others others others others others reference_word reference_word others others others others others others sample_function sample_function sample_function sample_function others others others others others others
In the event it is not successful , it proceeds to load and decrypt and embedded bitmap resource file .		others others others others others others others others reference_word others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
This decrypted data is written to the following location :  %TEMP%\WUpdate.~tmp .		others others others others others others others others others others others others others others others
This 'WUpdate.~tmp' file is then copied to a filename of 'Applet.cpl' , which is placed in the previously identified file path .		others others others others others others others others others others others others others others others others others others others others others others others others
The malware proceeds to identify the file path of either the common startup folder , or the user's startup folder depending on if the SeDebugPrivilege privilege was obtained .		reference_word reference_word others others sub_activity sub_activity sub_activity sub_activity others others others others others others others others others person others others others others others others others tool others others others others
In the event this privilege was obtained , the common startup folder is queried by reading the following registry key :  HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Common Startup .		others others others reference_word reference_word others others others others sample_function sample_function sample_function sample_function sample_function others sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others
Alternatively , if the privilege was unable to be obtained , Reaver.v2 will obtain the user's startup folder by querying the following registry key :  HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Startup .		others others others others others others others others others others others sample_name others sample_function sample_function person sample_function sample_function sample_function others sub_activity sub_activity sub_activity sub_activity sub_activity others others others others
Reaver proceeds to write a shortcut file to '%TEMP%\~WUpdate.lnk' .		malware others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
This file is then copied to a filename of 'Windows Update.lnk' , which is placed in the startup path previously identified .		reference_word reference_word others others others others others others others others sample_name others others others others others others others others others others others others
This shortcut file points to the path of the previously written 'Applet.cpl' file .		reference_word reference_word reference_word others others others others others others others others others others others others
Finally , Reaver.v1 will execute the '~WUpdate.lnk' file in a new process , thus loading the recently dropped malicious CPL file .		others others sample_name others others others others others others others others others others others others sample_function sample_function sample_function sample_function sample_function tool sample_function others
Reaver.v2 begins by attempting to enable the SeDebugPrivilege privilege for the running process .		sample_name others others others others sub_activity sub_activity tool sub_activity others others sample_function sample_function others
In the event this is successful , the malware will use the following path to store any dropped files :  %COMMONPROGRAMFILES%\services\ .		others others others others others others others reference_word reference_word others others others others others others sub_activity sub_activity sub_activity sub_activity others others others others others others
In the event it is not successful , this alternative path will be used instead :  %APPDATA%\microsoft\mmc\ .		others others others others others others others others others others others others others others others others others others others others others
Reaver.v2 proceeds to decrypt an embedded file using a simple XOR obfuscation routine .		sample_name others others sample_function sample_function sample_function sample_function others others others encryption_algo sub_activity sub_activity others
This file is written to the following file path :  % TEMP%\Update.~tmp .		reference_word reference_word others others others others others others others others others others others others others
After the file is written , it is then copied to a filename of 'winhelp.cpl' in the directory that was initially chosen .		others reference_word reference_word others others others others others others others others others others others others others others others others others others others others others
After this file is copied , the original 'Update.~tmp' file is deleted .		others reference_word reference_word others others others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
At this stage the malware will identify the correct startup path using the same technique witnessed in earlier variants .		others others others reference_word reference_word others sample_function sample_function sample_function sample_function sample_function others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
A shortcut file is generated in the following path :  %TEMP%\~Update.lnk .		others others others others others others others others others others others others others others others
This '~Update.lnk' file is then copied to a filename of 'Windows help.lnk' , which is placed in the startup path previously identified .		others others others others others others others others others others others others sample_name others others others others others others others others others others others others
This shortcut file points to the path of the previously written 'winhelp.cpl' file .		reference_word reference_word reference_word others others others others others others others others others others others others
It will specifically load this CPL file via a call to the built-in Microsoft Windows 'control.exe' utility .		reference_word others others others reference_word tool reference_word others others others others others others company OS_name others others others others
Finally , Reaver.v2 will execute the '~Update.lnk' file in a new process , thus loading the recently dropped malicious CPL file .		others others sample_name others others others others others others others others others others others others others others sub_activity sub_activity sub_activity tool sub_activity others
Like Reaver.v2 , Reaver.v3 begins by attempting to enable the SeDebugPrivilege privilege for the running process .		others sample_name others sample_name others others others others sub_activity sub_activity tool sub_activity others others sample_function sample_function others
In the event this is successful , the malware will use the following path to store any dropped files :  %COMMONPROGRAMFILES%\services\ .		others others others others others others others reference_word reference_word others others others others others others sub_activity sub_activity sub_activity sub_activity others others others others others others
In the event it is not successful , this alternative path will be used instead :  %APPDATA%\microsoft\credentials\ .		others others others others others others others others others others others others others others others others others others others others others
Reaver.v3 proceeds to write an embedded Microsoft Cabinet ( CAB ) file to the following location :  %TEMP%\winhelp.dat .		sample_name others others others others sub_activity company tool sub_activity tool sub_activity sub_activity others others others others others others others others others others
This cabinet file is then extracted to the previously identified file path .		reference_word reference_word reference_word others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
The contents of this cabinet file consist of a Microsoft Control Panel item with a filename of 'winhelp.cpl' .		others others others reference_word reference_word reference_word others others others company tool tool sub_activity others others others others others others others
Much like the previous version of Reaver , Reaver.v3 will query the necessary registry keys to determine the correct startup path to use .		others others others others others others malware others sample_name others sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others
Again , a shortcut file is written to the %TEMP% path with a name of '~Update.lnk' , which is in turn copied to the identified startup path with a filename of 'Windows help.lnk' .		others others others sub_activity sub_activity others others others others others others others others others others others others others others others others others others others others others others others others others others others others others others sample_name others others
This shortcut file calls the built-in 'control.exe' utility to in turn load the previously dropped malicious CPL file of 'winhelp.cpl' .		reference_word reference_word reference_word others others others others others others others others others others others others others sub_activity tool sub_activity others others others others
Finally , the malware calls the 'winhelp.cpl' file in a new process via the following command :  control [path_previously_identified]\winhelp.cpl .		others others reference_word reference_word others others others others others others others others others others others others others others others others others others others others
The malicious CPL payload of Reaver has the following two exported functions :  CPlApplet , DllEntryPoint .		others sub_activity tool sub_activity others malware others others others others others others others function others function others
When the CPlApplet function is loaded , Reaver will initially determine if the SeDebugPrivilege privilege is able to be obtained .		others others function others others others others malware others others others others others tool others others others others others others others
The malware proceeds to decrypt and embedded configuration of 128 bytes using a simple XOR routine .		reference_word reference_word others others sample_function sample_function sample_function sample_function sample_function sample_function sample_function others others sub_activity encryption_algo sub_activity others
The following information is present within this configuration :  Remote Command and Control ( C2 ) server , Remote port , Sleep timer .		others others others others others others reference_word reference_word others sub_activity tool tool tool sub_activity tool sub_activity sub_activity others sub_activity sub_activity others tool tool others
The malware proceeds to communicate with the remote server via HTTP GET and POST requests .		reference_word reference_word others others sample_function sample_function sample_function sample_function sample_function others protocol function others function others others
Data that is sent is compressed and then base64-encoded before being included in the requests .		others others others others others others others others encryption_algo others others others others others others others
The following capabilities of this payload :  Get drive information , Read files , Write files , Delete files , Move files , Spawn processes , Create directories .		others others others others reference_word reference_word others sample_function sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others
The malicious CPL payload of Reaver has the following three exported functions :  ServiceMain , CPlApplet , DllEntryPoint .		others sub_activity tool sub_activity others malware others others others others others others others function others function others function others
When the malware is initially loaded , DllEntryPoint will be called , which in turn will call a function that is responsible for decompressing a blob of data .		others reference_word reference_word others others others others function others others others others others others others others others others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity others
The decompressed data consists of various key/value pairings that represent important strings used by Reaver .		others sub_activity sub_activity others others others sub_activity sub_activity others others others others others others malware others
When the malware wishes to retrieve one of these decoded strings , it will simply call a function with an integer argument that is responsible for providing it .		others reference_word reference_word others others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others others others
For example , calling this function with an argument of '10001' would retrieve a string of 'ole32.dll' .		others others others others others others others others others others others others others others others others others others others others
The DllEntryPoint function proceeds to attempt to obtain the SeDebugPrivilege privilege , and also calls WSAStartup for future network activity .		others function others others others sub_activity sub_activity sub_activity sub_activity tool sub_activity others others others others function others sub_activity sub_activity sub_activity others
When the CPlApplet function is loaded , it will begin by decompressing an embedded configuration using the same compression algorithm used previously .		others others function others others others others others others others others sample_function sample_function sample_function sample_function others others sub_activity sub_activity sub_activity sub_activity sub_activity others
The malware proceeds to check to see if the original dropped malware file exists .		others others others others others others others others others sub_activity sub_activity sub_activity sub_activity others others
In the event it does , Reaver will move this file to '%TEMP%\~FJIOW.tmp' and delete this new file .		others others others others others others malware others sub_activity sub_activity sub_activity others others others others others others others others sub_activity sub_activity sub_activity sub_activity others
This simply acts as cleanup to ensure original file artifacts no longer reside on the infected machine .		others others others others others others others others others others others others others others others others others others
Reaver will then install itself as a service in the event it is running with SeDebugPrivilege privileges .		malware others others sub_activity sub_activity sub_activity sub_activity sub_activity others others others others others sub_activity sub_activity sub_activity sub_activity others
The service is configured with a name , description , and display name that is provided within the configuration .		others others others others others others others others others others others others others others others others others others others others
Reaver continues to collect various information from the victim machine , including the following :  Computer name , Volume serial number , Microsoft Windows version , CPU speed , ANSI code page , OEM code page identifier for the operating system , Physical and virtual memory information .		malware others others sub_activity sub_activity sub_activity others others target_crowd target_crowd others others others others others sub_activity sub_activity others sub_activity sub_activity sub_activity others company OS_name sub_activity others tool sub_activity others sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity others
Reaver encrypts this data using an incremental XOR key and uploads it to the configured remote server on the port specified .		malware sub_activity reference_word reference_word others others sub_activity encryption_algo sub_activity others sub_activity sub_activity sub_activity sub_activity sub_activity tool tool others others others others others
After this data is exfiltrated , the malware expects 8 bytes of data that contains two DWORDs .		others reference_word reference_word others others others reference_word reference_word others others others others others others others sub_activity encryption_algo others
These DWORDs contain both a major command and a sub-command .		reference_word reference_word others others others sub_activity sub_activity others others sub_activity others
The following capabilities have been observed in this payload :  Get drive information , Modify files , Modify directories , Modify registry , Spawn process , Terminate process , Modify services , Kill self .		others others others others others others others reference_word reference_word others sample_function sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others sample_function sample_function others
Reaver was used concurrently with SunOrcal over the past year , to include two Reaver samples dropped from zip files hosted on a domain also being used as a SunOrcal C2 ( www.fyoutside.com ) , and there is also passive DNS overlap amongst the C2s .		malware others others others others malware others others others others others others others sub_activity malware sub_activity others others tool sub_activity others others others others others others others others others malware tool others domain_evil others others others others others others sub_activity protocol sub_activity others others tool others
Specifically , Reaver to date has used www.tashdqdxp.com for C2 , which overlaps with www.weryhstui.com , another C2 used by SunOrcal samples during the same timeframe .		others others malware others others others others domain_evil others tool others others others others domain_evil others others tool others others malware others others others others others others
Both domains have resolved to 98.126.156.210 .		others others others others others IP_evil others
Several of those same SunOrcal samples were also using www.fyoutside.com as an additional C2 .		others others others others malware sub_activity others others others domain_evil others others others tool others
This led to further C2 ties within SunOrcal samples , to include samples beaconing to www.olinaodi.com .		others others others others tool others others malware sub_activity others others others others others others domain_evil others
The attackers behind SunOrcal , whose activity dates to at least 2013 and possibly 2010 , remain active and are still developing new custom malware to use against their targets .		others person others malware others others others others others others others time others others time others others others others others others sub_activity sub_activity sub_activity sub_activity others sample_function sample_function sample_function sample_function others
The new malware , Reaver , appears to have been in the wild since late 2016 with less than a dozen known samples , among which there are three variants .		others others others others malware others others others others others others others others others others time others others others others others others others others others others others others others others others
It is also unique in the fact that its final payload is in a CPL file , a technique which Palo Alto Networks has seen with only 0.006% of all malware samples we have analyzed .		reference_word others others others others others others others others tool tool others others others tool others others others others others company company company others others others others others others others others others others others others others others
The attackers used both families concurrently from late last year through November 2017 and there is some C2 infrastructure overlap between the two families , as well as links to historical reporting .		others person others reference_word reference_word others others others others others others time time others others others others tool others others others others others others others others others others others others others others others
Reaver.v1 :  d560f44188fb56d3abb11d9508e1167329470de19b811163eb1167534722e666 .		sample_name others sha2 others
Reaver.v2 :  98eb5465c6330b9b49df2e7c9ad0b1164aa5b35423d9e80495a178eb510cdc1c .		sample_name others sha2 others
Reaver.v2 :  05ddbd0506ec95fb460b3994e5b21cdb0418ba4aa406374ca1b91249349b7640 .		sample_name others sha2 others
Reaver.v3 :  18ac3b14300ecfeed4b64a844c16dccb06b0e3513d0954d6c6182f2ea14e4c92 .		sample_name others sha2 others
Reaver.v3 :  c0f8bb77284b96e07cab1c3fab8800b1bbd030720c74628c4ee5666694ef903d .		sample_name others sha2 others
Reaver.v3 :  9213f70bce491991c4cbbbd7dc3e67d3a3d535b965d7064973b35c50f265e59b .		sample_name others sha2 others
Reaver.v3 :  26c234c73e2c3448589c7d4a0cf17f615ad3666541a4e611e2d8b77637205bcf .		sample_name others sha2 others
Reaver.v3 :  ae9f158e4886cfdbfb4f1b3b25707d05f6fd873d0be9d8e7334a2c28741228ee .		sample_name others sha2 others
Reaver.v3 :  1fcda755e8fa23d27329e4bc0443a82e1c1e9a6c1691639db256a187365e4db1 .		sample_name others sha2 others
Reaver.v3 :  c906250e0a4c457663e37119ebe1efa1e4b97eef1d975f383ac3243f9f09908c .		sample_name others sha2 others
Reaver.v3 :  1813f10bcf74beb582c824c64fff63cb150d178bef93af81d875ca84214307a1 .		sample_name others sha2 others
SunOrcal :  799139b5278dc2ac24279cc6c3db44f4ef0ea78ee7b721b0ace38fd8018c51ac .		malware others sha2 others
SunOrcal :  81d887fefdbb0219647991c2b7bddf45c2fede4dc6fc18408f1706e0279615b2 .		malware others sha2 others
SunOrcal :  58312fb742ce881e040e1b5b8555f00a402b8dd4fc886acaae2f862040b3bfc5 .		malware others sha2 others
SunOrcal :  38ea33dab0ba2edd16ecd98cba161c550d1036b253c8666c4110d198948329fb .		malware others sha2 others
SunOrcal :  cb7c0cf1750baaa11783e93369230ee666b9f3da7298e4d1bb9a07af6a439f2f .		malware others sha2 others
SunOrcal :  www.tashdqdxp.com .		malware others domain_evil others
SunOrcal :  www.weryhstui.com .		malware others domain_evil others
SunOrcal :  www.fyoutside.com .		malware others domain_evil others
SunOrcal :  www.olinaodi.com .		malware others domain_evil others
SunOrcal :  104.148.70.217 .		malware others IP_evil others
SunOrcal :  98.126.156.210 .		malware others IP_evil others